<!DOCTYPE html><html lang="en"><head itemscope=""><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"insights","name":"Insights"}},{"@type":"ListItem","position":2,"item":{"@id":"ClickHouse","name":"ClickHouse"}}]},{"@type":"BlogPosting","@id":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","url":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","name":"Analyze your {A|N}LB logs with ClickHouse","headline":"Analyze your {A|N}LB logs with ClickHouse","abstract":"<p>Written by: Andrei Tserakhau, DoubleCloud Tech Lead</p>","description":"<p>Written by: Andrei Tserakhau, DoubleCloud Tech Lead</p>","dateCreated":"2024-05-24T00:00:00Z","datePublished":"2024-05-24T00:00:00Z","dateModified":"2024-05-24T00:00:00Z","author":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"creator":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"publisher":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"copyrightHolder":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"copyrightYear":2025,"mainEntityOfPage":{"@type":"WebPage","@id":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/"},"inLanguage":{"@type":"Language","name":"English","alternateName":"en"},"keywords":["Insights","ClickHouse"],"image":"https://double.cloud/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-small-cover.png","sharedContent":{"@type":"WebPage","headline":"Analyze your {A|N}LB logs with ClickHouse","url":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","author":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}}},"wordCount":"","articleBody":""}]}</script><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Analyze your {A|N}LB logs with ClickHouse | DoubleCloud</title><meta name="description" content="Learn how to efficiently analyze your ALB/NLB logs with ClickHouse. This guide covers storing logs in an S3 bucket, setting up VPC and ClickHouse at DoubleCloud, connecting ClickHouse with S3 logs via Transfer at DoubleCloud, and delving into log analysis.&quot;"/><link rel="canonical" href="analyze-your-anlb-logs-with-clickhouse.html"/><meta itemProp="name" content="Analyze your {A|N}LB logs with ClickHouse"/><meta itemProp="description" content="&lt;p&gt;Written by: Andrei Tserakhau, DoubleCloud Tech Lead&lt;/p&gt;"/><meta itemProp="image" content="https://double.cloud/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png"/><meta property="og:type" content="website"/><meta property="og:url" content="https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/"/><meta property="og:title" content="Analyze your {A|N}LB logs with ClickHouse"/><meta property="og:description" content="&lt;p&gt;Written by: Andrei Tserakhau, DoubleCloud Tech Lead&lt;/p&gt;"/><meta property="og:image" content="https://double.cloud/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png"/><meta property="og:locale" content="en"/><meta property="og:site_name" content="DoubleCloud"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Analyze your {A|N}LB logs with ClickHouse"/><meta name="twitter:description" content="&lt;p&gt;Written by: Andrei Tserakhau, DoubleCloud Tech Lead&lt;/p&gt;"/><meta name="twitter:image" content="https://double.cloud/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png"/><meta name="robots" content="follow, index"/><meta property="article:published_time" content="2024-05-24T00:00:00Z"/><meta property="article:author" content=""/><meta property="article:tag" content="Insights"/><meta property="article:tag" content="ClickHouse"/><meta name="next-head-count" content="25"/><link rel="icon" href="../../../../assets/favicon/favicon.ico" sizes="any"/><link type="image/x-icon" rel="shortcut icon" href="../../../../assets/favicon/favicon.ico"/><link type="image/png" sizes="16x16" rel="icon" href="../../../../assets/favicon/favicon-16x16.png"/><link type="image/png" sizes="32x32" rel="icon" href="../../../../assets/favicon/favicon-32x32.png"/><link type="image/png" sizes="120x120" rel="icon" href="../../../../assets/favicon/favicon-120x120.png"/><link type="image/png" sizes="192x192" rel="icon" href="../../../../assets/favicon/favicon-192x192.png"/><link type="image/png" sizes="76x76" rel="apple-touch-icon" href="https://double.cloud/assets/favicon/favicon-76x76.png"/><link type="image/png" sizes="152x152" rel="apple-touch-icon" href="../../../../assets/favicon/favicon-152x152.png"/><link type="image/png" sizes="180x180" rel="apple-touch-icon" href="../../../../assets/favicon/favicon-180x180.png"/><script id="data-google-tag-manager" nonce="gwgZFjTksMop1rFAK5zXCA==" data-nonce="gwgZFjTksMop1rFAK5zXCA==">
                // Define dataLayer and the gtag function.
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}

                // Default analytics_storage to 'denied'.
                window.gtag = window.gtag || gtag;

                const hasAnalyticsConsent = window?.localStorage.getItem('hasAnalyticsConsent');
                const consent =  hasAnalyticsConsent === 'true' ? 'granted' : 'denied';

                window.gtag('consent', 'default', {
                    'analytics_storage': consent,
                    'ad_storage': consent,
                    'wait_for_update': hasAnalyticsConsent === 'true' ? 0 : Infinity,
                });

                dataLayer.push({
                    'event': 'default_consent'
                });

                (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;var n=d.querySelector('[nonce]');
                n&&j.setAttribute('nonce',n.nonce||n.getAttribute('nonce'));f.parentNode.insertBefore(j,f);
                })(window,document,'script','dataLayer','GTM-5M39N8J');
            </script><script nonce="gwgZFjTksMop1rFAK5zXCA==">window.__webpack_nonce__ = "gwgZFjTksMop1rFAK5zXCA=="</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="preconnect" href="https://snap.licdn.com"/><link rel="preconnect" href="https://www.google.com"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="preload" href="../../../../_next/static/css/a4c87e381fd61058.css" as="style"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="stylesheet" href="../../../../_next/static/css/a4c87e381fd61058.css" data-n-g=""/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="preload" href="../../../../_next/static/css/2facd84af36bff2e.css" as="style"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="stylesheet" href="../../../../_next/static/css/2facd84af36bff2e.css" data-n-p=""/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="preload" href="../../../../_next/static/css/c413166e8b0da734.css" as="style"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="stylesheet" href="../../../../_next/static/css/c413166e8b0da734.css" data-n-p=""/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="preload" href="../../../../_next/static/css/248e88462928fa2f.css" as="style"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="stylesheet" href="../../../../_next/static/css/248e88462928fa2f.css" data-n-p=""/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="preload" href="../../../../_next/static/css/eb8a627e7f585420.css" as="style"/><link nonce="gwgZFjTksMop1rFAK5zXCA==" rel="stylesheet" href="../../../../_next/static/css/eb8a627e7f585420.css" data-n-p=""/><noscript data-n-css="gwgZFjTksMop1rFAK5zXCA=="></noscript><script defer="" nonce="gwgZFjTksMop1rFAK5zXCA==" nomodule="" src="../../../../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="../../../../_next/static/chunks/webpack-d326a7489defa990.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/framework-cc7effedd0fd3d95.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/main-ebfff3515213fa2f.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/pages/_app-4cd98c5be1eceb26.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/f69bbb46-eed95df46583a2d8.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/030d571f-c7510aa4f8d650e7.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/193-fdb54e47dd6b7c7b.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/756-04d1c95c632019ed.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/387-27526d5e8e2a9173.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/chunks/pages/blog/posts/[...slug]-896d627301783262.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/HkxA3M0ES7gp3V0n_0ecw/_buildManifest.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script><script src="../../../../_next/static/HkxA3M0ES7gp3V0n_0ecw/_ssgManifest.js" nonce="gwgZFjTksMop1rFAK5zXCA==" defer=""></script></head><body class="dc-root g-root g-root_theme_dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5M39N8J" title="Googletagmanager" height="0" width="0" style="display:none;visibility:hidden" loading="lazy"></iframe></noscript><div id="__next" data-reactroot=""><div class="layout"><div class="layout__content"><div class="g-root g-root_theme_dark pc-page-constructor"><div class="pc-page-constructor__wrapper"><div class="pc-layout"><div class="pc-Grid pc-navigation pc-layout__navigation"><div class="container-fluid "><div class="row"><div class="col"><nav><div class="pc-desktop-navigation__wrapper"><div class="pc-desktop-navigation__left"><div class="link" data-link-type="router"><span class="pc-logo pc-desktop-navigation__logo"><picture><img alt="Logo icon" src="../../../../assets/logo/dc-logo-dark.svg" class="pc-logo__icon"/></picture><span class="pc-logo__text"></span></span></div></div><div class="pc-desktop-navigation__navigation-container"><div class="pc-overflow-scroller__container"><div class="pc-overflow-scroller pc-desktop-navigation__navigation"><div class="pc-overflow-scroller__wrapper" style="left:0"><ul class="pc-desktop-navigation__links"><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><button class="dc-dropdown-navigation-item__control"><span class="dc-dropdown-navigation-item__title">Why DoubleCloud</span></button><div style="position:fixed;left:0;top:0" class="g-popup dc-dropdown-navigation-item__dropdown"><div class="g-popup__content dc-dropdown-navigation-item__dropdown-content-wrapper" tabindex="-1"><div class="group-list-content"><div class="row item-list-content"><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Performance" data-link-type="router" href="../../../../performance-boost/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Performance</span><span class="navigation-popup-item__description">Get the best performance with the highest ROI</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Security" data-link-type="router" href="../../../../security.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Security</span><span class="navigation-popup-item__description">Keep your data protected and maintain compliance</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="DoubleCloud vs. other solutions" data-link-type="router" href="../../../../comparison/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">DoubleCloud vs. other solutions</span><span class="navigation-popup-item__description">Learn how DoubleCloud’s products compare to other solutions</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Customer stories" data-link-type="router" href="../../../../resources/case-studies/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Customer stories</span><span class="navigation-popup-item__description">See our solutions in action</span></div></a></div></div><div class="group-list-content__banner"><picture><img alt="" src="../../../../assets/doublecloud/menu-bar/menu-banner-dc-results.png.webp" class="group-list-content__image" style="width:300px;height:300px"/></picture><span class="yfm yfm_constructor"><a href='../../../../performance-boost/index.html' target='_self'>Get more and spend less with DoubleCloud  →</a></span></div></div></div></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><button class="dc-dropdown-navigation-item__control"><span class="dc-dropdown-navigation-item__title">Products</span></button><div style="position:fixed;left:0;top:0" class="g-popup dc-dropdown-navigation-item__dropdown"><div class="g-popup__content dc-dropdown-navigation-item__dropdown-content-wrapper" tabindex="-1"><div class="row item-list-content"><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Managed Service for ClickHouse®" data-link-type="router" href="../../../../services/managed-clickhouse.html"><picture class="navigation-popup-item__icon-container"><img alt="" src="../../../../assets/icons/dc-clickhouse.svg" class="navigation-popup-item__icon"/></picture><div class="navigation-popup-item__container navigation-popup-item__container_with-margin"><span class="navigation-popup-item__title">Managed Service for ClickHouse®</span><span class="navigation-popup-item__description">The fastest, most resource-efficient OLAP database for real-time analytics</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Managed Service for Apache Kafka®" data-link-type="router" href="../../../../services/managed-kafka.html"><picture class="navigation-popup-item__icon-container"><img alt="" src="../../../../assets/icons/dc-kafka.svg" class="navigation-popup-item__icon"/></picture><div class="navigation-popup-item__container navigation-popup-item__container_with-margin"><span class="navigation-popup-item__title">Managed Service for Apache Kafka®</span><span class="navigation-popup-item__description">A leading data streaming technology for large-scale, data-intensive applications</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Managed Service for Apache Airflow®" data-link-type="router" href="../../../../services/managed-airflow/index.html"><picture class="navigation-popup-item__icon-container"><img alt="" src="../../../../assets/icons/dc-airflow.svg" class="navigation-popup-item__icon"/></picture><div class="navigation-popup-item__container navigation-popup-item__container_with-margin"><span class="navigation-popup-item__title">Managed Service for Apache Airflow®</span><span class="navigation-popup-item__description">Open-source tool to orchestrate and monitor workflows</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Data Transfer" data-link-type="router" href="../../../../services/doublecloud-transfer.html"><picture class="navigation-popup-item__icon-container"><img alt="" src="../../../../assets/icons/dc-transfer.svg" class="navigation-popup-item__icon"/></picture><div class="navigation-popup-item__container navigation-popup-item__container_with-margin"><span class="navigation-popup-item__title">Data Transfer</span><span class="navigation-popup-item__description">No-code ELT tool for aggregating, collecting, and migrating data</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Data Visualization" data-link-type="router" href="../../../../services/doublecloud-visualization.html"><picture class="navigation-popup-item__icon-container"><img alt="" src="../../../../assets/icons/dc-data-vis.svg" class="navigation-popup-item__icon"/></picture><div class="navigation-popup-item__container navigation-popup-item__container_with-margin"><span class="navigation-popup-item__title">Data Visualization</span><span class="navigation-popup-item__description">Free tool to create, modify, and share dashboards and charts</span></div></a></div></div></div></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><button class="dc-dropdown-navigation-item__control"><span class="dc-dropdown-navigation-item__title">Solutions</span></button><div style="position:fixed;left:0;top:0" class="g-popup dc-dropdown-navigation-item__dropdown"><div class="g-popup__content dc-dropdown-navigation-item__dropdown-content-wrapper" tabindex="-1"><div class="group-list-content"><div class="row item-list-content"><h4 class="item-list-content__title">By use case</h4><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Customer-facing analytics" data-link-type="router" href="../../../../customer-facing-analytics/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Customer-facing analytics</span><span class="navigation-popup-item__description">Provide business insights for your clients or partners</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Real-time analytics" data-link-type="router" href="../../../../solutions/real-time-analytics/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Real-time analytics</span><span class="navigation-popup-item__description">Build a data infrastructure to collect, process, and analyze data in real time</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Observability and monitoring" data-link-type="router" href="../../../../solutions/observability-and-monitoring/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Observability and monitoring</span><span class="navigation-popup-item__description">Analyze terabytes of your logs, events, and traces with ease</span></div></a></div></div><div class="row item-list-content"><h4 class="item-list-content__title">By industry</h4><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="AdTech and MarTech data analytics" data-link-type="router" href="../../../../solutions/adtech.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">AdTech and MarTech data analytics</span><span class="navigation-popup-item__description">Extract and analyze data from Meta ads, Google ads, LinkedIn ads, and others</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Analytics for mobile and gaming apps" data-link-type="router" href="../../../../solutions/web-mobile-gaming-apps.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Analytics for mobile and gaming apps</span><span class="navigation-popup-item__description">Optimize and scale your mobile and gaming app analytics</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="EdTech data analytics" data-link-type="router" href="../../../../solutions/edtech/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">EdTech data analytics</span><span class="navigation-popup-item__description">Improve online learning and identify new sales opportunities</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="FinTech data analytics" data-link-type="router" href="../../../../solutions/fintech-real-time-analytics/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">FinTech data analytics</span><span class="navigation-popup-item__description">Manage and process large amounts of financial data efficiently</span></div></a></div></div></div></div></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><button class="dc-dropdown-navigation-item__control dc-dropdown-navigation-item__control_selected"><span class="dc-dropdown-navigation-item__title">Resources</span></button><div style="position:fixed;left:0;top:0" class="g-popup dc-dropdown-navigation-item__dropdown"><div class="g-popup__content dc-dropdown-navigation-item__dropdown-content-wrapper" tabindex="-1"><div class="group-list-content"><div class="row item-list-content"><h4 class="item-list-content__title">Using DoubleCloud</h4><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="DoubleCloud API" href="../../../../docs/en/public-api/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">DoubleCloud API</span><span class="navigation-popup-item__description">Read up on API tutorials and instructions</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Terraform" href="../../../../docs/en/developer-resources/terraform/create-resources.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Terraform</span><span class="navigation-popup-item__description">Deploy and manage cloud resources with the infrastructure-as-code approach</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Status updates" data-link-type="router" href="https://status.double.cloud/"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Status updates</span><span class="navigation-popup-item__description">Check the current operational status of our services</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Support" data-link-type="router" href="../../../../support/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Support</span><span class="navigation-popup-item__description">Learn more about our support tiers</span></div></a></div></div><div class="row item-list-content"><h4 class="item-list-content__title">Discover</h4><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Webinars" data-link-type="router" href="../../../../webinars/index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Webinars</span><span class="navigation-popup-item__description">Sign up for the next webinar or watch previous ones</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover navigation-popup-item__content_selected" aria-label="Blog" data-link-type="router" href="../../../index.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Blog</span><span class="navigation-popup-item__description">Get insights from our team and the latest news</span></div></a></div></div><div class="group-list-content__banner"><picture><img alt="" src="../../../../assets/doublecloud/menu-bar/menu-banners-dc-ebook.png.webp" class="group-list-content__image" style="width:300px;height:300px"/></picture><span class="yfm yfm_constructor"><a href='../../../../resources/clickhouse-ebook/index.html' target='_self'>Grab your ebook  →</a></span></div></div></div></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><button class="dc-dropdown-navigation-item__control"><span class="dc-dropdown-navigation-item__title">Company</span></button><div style="position:fixed;left:0;top:0" class="g-popup dc-dropdown-navigation-item__dropdown"><div class="g-popup__content dc-dropdown-navigation-item__dropdown-content-wrapper" tabindex="-1"><div class="row item-list-content"><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="About DoubleCloud" data-link-type="router" href="../../../../company/about-us.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">About DoubleCloud</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Careers" data-link-type="router" href="../../../../company/careers.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Careers</span></div></a></div><div class="col  col-12 navigation-popup-item item-list-content__item"><a class="navigation-popup-item__content navigation-popup-item__content_hover" aria-label="Contact us" data-link-type="router" href="../../../../company/contact-us.html"><div class="navigation-popup-item__container"><span class="navigation-popup-item__title">Contact us</span></div></a></div></div></div></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><a aria-label="Pricing" class="pc-navigation-item__content pc-navigation-item__content_type_link" data-link-type="router" href="../../../../pricing.html"><div class="navigation-item"><span class="navigation-item__text">Pricing</span></div></a></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><a href="../../../../docs/index.html" aria-label="Documentation" class="pc-navigation-item__content pc-navigation-item__content_type_link" target="_self"><div class="navigation-item"><span class="navigation-item__text">Documentation</span></div></a></li></ul></div></div></div></div><div class="pc-desktop-navigation__right"><button type="button" aria-label="Button label" class="pc-control pc-control_size_l pc-control_theme_primary pc-mobile-menu-button"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" class="g-icon" fill="currentColor" stroke="none" data-qa="icon-test-id" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M1.25 3.25A.75.75 0 0 1 2 2.5h12A.75.75 0 0 1 14 4H2a.75.75 0 0 1-.75-.75Zm0 4.75A.75.75 0 0 1 2 7.25h12a.75.75 0 0 1 0 1.5H2A.75.75 0 0 1 1.25 8ZM2 12a.75.75 0 0 0 0 1.5h12a.75.75 0 0 0 0-1.5H2Z" clip-rule="evenodd"></path></svg></svg></button><ul class="pc-desktop-navigation__buttons"><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><div class="link" data-link-type="router"><a class="g-button g-button_view_flat g-button_size_l g-button_pin_round-round pc-button-block pc-button-block_position_left pc-button-block_size_l pc-button-block_theme_flat pc-navigation-button pc-navigation-item__content pc-navigation-item__content_type_button" href="https://join.slack.com/t/double-cloud/shared_invite/zt-1pbz9lfte-5GoIX~8CmVYqmVQfRFPNdA" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><img class="pc-button-block__image" src="../../../../assets/icons/slack.svg" alt="Button image"/><span class="pc-button-block__text">Slack</span></span></span></a></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><div class="link" data-link-type="router"><a class="g-button g-button_view_flat g-button_size_l g-button_pin_round-round pc-button-block pc-button-block_size_l pc-button-block_theme_flat pc-navigation-button pc-navigation-item__content pc-navigation-item__content_type_button" href="analyze-your-anlb-logs-with-clickhouse.html#contact-us-form" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Contact us</span></span></span></a></div></li><li class="pc-navigation-item pc-navigation-item_menu-layout_desktop pc-desktop-navigation__item"><div class="link" data-link-type="router"><a class="g-button g-button_view_action g-button_size_l g-button_pin_round-round pc-button-block pc-button-block_size_l pc-button-block_theme_accent pc-navigation-button pc-navigation-item__content pc-navigation-item__content_type_button" href="https://app.double.cloud" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Console</span></span></span></a></div></li></ul></div></div><div></div></nav></div></div></div></div><main class="pc-layout__content"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><header class="pc-header-block pc-header-block_media-view_full"><div class="pc-header-block__background pc-header-block__background_media" style="background-color:#000000"><div class="pc-Media pc-header-block__background-media" style="background-color:#000000"><div style="transform:"><div class="pc-storage-background-image pc-media-component-image__item pc-header-block__image" data-qa="background-image"><picture data-qa="background-image-image"><img fetchpriority="high" alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-cover.png" class="pc-storage-background-image__img"/></picture></div></div></div></div><div class="pc-Grid"><div class="container-fluid pc-header-block__container-fluid"><div class="row pc-header-block__breadcrumbs"><div class="col"><div class="pc-header-breadcrumbs pc-header-breadcrumbs_theme_light" aria-label="You are here:"><div class="pc-header-breadcrumbs__item"><a href="../../../index.html" class="pc-header-breadcrumbs__text">Blog</a></div><div class="pc-header-breadcrumbs__item"><a href="../../../index.html%3Ftags=insights.html" class="pc-header-breadcrumbs__text">Insights</a></div></div></div></div><div class="row"><div class="col col-reset pc-header-block__content-wrapper"><div class="row"><div class="col pc-header-block__content pc-header-block__content_offset_default pc-header-block__content_theme_light pc-header-block__content_vertical-offset_m"><div class="col  col-lg-6 col-sm-12 col-md-8 col-12 pc-header-block__content-inner"><h1 class="pc-header-block__title" id="g-uniq-597264"><span>Analyze your {A|N}LB logs with ClickHouse</span></h1><div class="pc-header-block__description"><div class="yfm yfm_constructor yfm_constructor_theme_light"><p>Written by: Andrei Tserakhau, DoubleCloud Tech Lead</p></div></div><div class="bc-post-info__container bc-post-info__container_theme_light"><div class="bc-post-info__item bc-post-info__item_size_s" data-qa="blog-header-meta-container-date">May 24, 2024</div><div class="bc-post-info__item bc-post-info__item_size_s" data-qa="blog-header-meta-container-reading-time"><span class="bc-post-info__icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" class="g-icon bc-post-info__icon-color" fill="currentColor" stroke="none" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16.004a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm3.357-3.736a1 1 0 0 0-.342-1.372L9 7.688V5.004a1 1 0 0 0-2 0v3.25a1 1 0 0 0 .486.857l2.5 1.5a1 1 0 0 0 1.371-.343Z"></path></svg></svg></span>15 mins to read</div><div class="bc-post-info__item"><div class="bc-post-info__icon"><div class="g-popover gc-share-popover bc-post-info__share"><button class="gc-share-popover__container bc-post-info__switcher bc-post-info__switcher_theme_light" aria-expanded="false" aria-controls="g-uniq-597265" aria-describedby="g-uniq-597265"><div class="gc-share-popover__icon-container"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" class="g-icon gc-share-popover__icon bc-post-info__share-icon" fill="currentColor" stroke="none" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.798 3.16a.5.5 0 0 0 .363.842H7V9a1 1 0 0 0 2 0V4.002h1.839a.5.5 0 0 0 .363-.844L8.363.156a.5.5 0 0 0-.726 0l-2.84 3.002.001.001ZM13 7a1 1 0 0 1 2 0v6.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 13.5V7a1 1 0 0 1 2 0v6h10V7Z"></path></svg></svg></div><div class="gc-share-popover__title">Share</div></button></div></div></div></div></div></div></div></div></div></div></div></header></section><div class="pc-Grid"><div class="container-fluid "><div class="row pc-constructor-row"><div class="col"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><p>Enabling the power of&nbsp;ClickHouse to&nbsp;consolidate logs offers a&nbsp;game-changing approach. It&rsquo;s cost-effective, lightning-fast, and effortlessly scales to&nbsp;accommodate your needs.</p>
<p>AWS stores Load Balancer Logs in&nbsp;S3, employing a&nbsp;queue system for a&nbsp;seamless CDC (Change Data Capture) style delivery. This synergy between S3's queuing mechanism and ClickHouse lays a&nbsp;robust foundation for efficient log analysis. And DoubleCloud makes this even easier with the power of&nbsp;Transfer service.</p>
<p>With Terraform at&nbsp;your disposal, setting up&nbsp;log aggregation becomes a&nbsp;straightforward process.</p>
<h2 id="lay-the-groundwork"><a href="analyze-your-anlb-logs-with-clickhouse.html#lay-the-groundwork" class="yfm-anchor" aria-hidden="true"><span class="visually-hidden">Lay the groundwork</span></a>Lay the groundwork</h2>
<p>So, how do&nbsp;you build the essential components for a&nbsp;scalable and fast observability stack, dedicated to&nbsp;dissecting and understanding AWS NLB or&nbsp;ALB access logs?</p>
<p>To&nbsp;set the stage, envision a&nbsp;baseline scenario&nbsp;&mdash; a&nbsp;typical application setup incorporating an&nbsp;AWS Load Balancer. As&nbsp;a&nbsp;fundamental part of&nbsp;AWS services, Load Balancers funnel logs into an&nbsp;S3 bucket. Now, let&rsquo;s take a&nbsp;guided tour through the step-by-step process, unveiling how these essential load-balancer logs seamlessly become accessible for real-time analysis in&nbsp;ClickHouse, all orchestrated through Terraform.</p>
<p>But before we&nbsp;venture into the Terraform magic, it&rsquo;s essential to&nbsp;picture the existing infrastructure and the pivotal Terraform code that configures the seamless interplay between S3 and SQS for the ALB.</p></div></section></div></div><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-media-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l bc-media__container"><div class="bc-media__border" data-qa="blog-media-content"><div class="pc-Media bc-media__content"><picture><source srcSet="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1.png.webp" type="image/webp"/><img alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1.png" class="pc-media-component-image__item bc-media__image"/></picture></div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><p>In&nbsp;this article, we&rsquo;ll talk about:</p>
<ul>
<li><a href="analyze-your-anlb-logs-with-clickhouse.html#s3-bucket-where-the-logs-are-stored-by-aws">S3 bucket where the logs are stored by&nbsp;AWS</a></li>
<li><a href="analyze-your-anlb-logs-with-clickhouse.html#setup-vpc-and-clickhouse-at-doublecloud">Setup VPC and Clickhouse at&nbsp;DoubleCloud</a></li>
<li><a href="analyze-your-anlb-logs-with-clickhouse.html#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud">Connect Clickhouse with S3 Logs via Transfer at&nbsp;DoubleCloud</a></li>
<li><a href="analyze-your-anlb-logs-with-clickhouse.html#looking-into-logs">Looking into logs</a></li>
</ul></div></section></div></div></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><h2 id="s3-bucket-where-the-logs-are-stored-by-aws"><a href="analyze-your-anlb-logs-with-clickhouse.html#s3-bucket-where-the-logs-are-stored-by-aws" class="yfm-anchor" aria-hidden="true"><span class="visually-hidden">S3 bucket where the logs are stored by&nbsp;AWS</span></a>S3 bucket where the logs are stored by&nbsp;AWS</h2>
<p>At&nbsp;the outset, our priority is&nbsp;setting up&nbsp;log storage for your ALB, a&nbsp;crucial step that involves binding an&nbsp;S3 bucket to&nbsp;your existing ALB.</p>
<p>Let&rsquo;s kick off with the foundational element: the creation of&nbsp;an&nbsp;S3 Bucket.</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L1-L3">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "aws_s3_bucket" "nlb_logs" {
  bucket = var.bucket_name
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="12">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-12" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-12" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-12.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>This snippet lays the groundwork by&nbsp;creating an&nbsp;S3 bucket dedicated to&nbsp;storing ALB logs, thereby serving as&nbsp;a&nbsp;repository for AWS ALB logs.</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "aws_lb" "alb" {
  /* your config
  */

  dynamic "access_logs" {
    for_each = var.access_logs_bucket != null ? { enabled = true } : {}

    content {
      enabled = true
      bucket  = var.bucket_name
      prefix  = var.access_logs_bucket_prefix
    }
  }
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="16">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-16" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-16" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-16.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Now, let&rsquo;s move forward with setting up&nbsp;the necessary configuration for an&nbsp;SQS queue to&nbsp;complement this S3 bucket.</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/sqs.tf#L1-L20">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "aws_sqs_queue" "nlb_logs_queue" {
  name   = var.sqs_name
  policy = &lt;&lt;POLICY
{
  "Version": "2012-10-17",
  "Id": "sqspolicy",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "sqs:SendMessage",
      "Resource": "arn:aws:sqs:*:*:${var.sqs_name}",
      "Condition": {
        "ArnEquals": { "aws:SourceArn": "${aws_s3_bucket.nlb_logs.arn}" }
      }
    }
  ]
}
POLICY
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="23">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-23" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-23" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-23.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>This code initiates the creation of&nbsp;an&nbsp;SQS queue, facilitating the seamless delivery of&nbsp;ALB logs to&nbsp;the designated S3 bucket.</p>
<p>As&nbsp;logs are delivered, they are automatically organized within a&nbsp;dedicated folder:</p></div></section></div></div><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-media-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l bc-media__container"><div class="bc-media__border" data-qa="blog-media-content"><div class="pc-Media bc-media__content"><picture><source srcSet="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1-screenshot.png.webp" type="image/webp"/><img alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1-screenshot.png" class="pc-media-component-image__item bc-media__image"/></picture></div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><p>Regularly generated new log files demand a&nbsp;streamlined approach for notification and processing. To&nbsp;establish a&nbsp;seamless notification channel, we&rsquo;ll configure an&nbsp;optimal push notification system via&nbsp;SQS. Referencing the guidelines outlined in&nbsp;<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html">Amazon S3's notification configuration documentation</a>, our next step involves the creation of&nbsp;an&nbsp;SQS queue. This queue will serve as&nbsp;the conduit for receiving timely notifications, ensuring prompt handling and processing of&nbsp;newly generated log files within our S3 bucket.</p>
<p>This linkage is&nbsp;solidified through the creation of&nbsp;the SQS queue:</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L54-L61">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "aws_s3_bucket_notification" "nlb_logs_bucket_notification" {
  bucket = aws_s3_bucket.nlb_logs.id

  queue {
    queue_arn = aws_sqs_queue.nlb_logs_queue.arn
    events    = ["s3:ObjectCreated:*"]
  }
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="9">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-9" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-9" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-9.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>All the configurations implemented so&nbsp;far serve as&nbsp;the foundational infrastructure for streamlined log storage. From setting up&nbsp;the S3 bucket to&nbsp;configuring the SQS queue and establishing the intricate linkage between them, this orchestrated setup forms the backbone for efficient log management and processing:</p></div></section></div></div><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-media-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l bc-media__container"><div class="bc-media__border" data-qa="blog-media-content"><div class="pc-Media bc-media__content"><picture><source srcSet="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2.png.webp" type="image/webp"/><img alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2.png" class="pc-media-component-image__item bc-media__image"/></picture></div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><p>The illustration above showcases the composed architecture, where the S3 bucket, SQS queue, and their interconnection stand as&nbsp;pivotal components for storing and managing logs effectively within the AWS environment.</p>
<p>Logs are now in&nbsp;your S3 bucket, but reading them may be&nbsp;challenging. Lets take a&nbsp;look at&nbsp;a&nbsp;data sample:</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">tls 2.0 2024-01-02T23:58:58 net/preprod-public-api-dt-tls/9f8794be28ab2534 4d9af2ddde90eb82 84.247.112.144:33342 10.0.223.207:443 244 121 0 15 - arn:aws:acm:eu-central-1:840525340941:certificate/5240a1e4-c7fe-44c1-9d89-c256213c5d23 - ECDHE-RSA-AES128-GCM-SHA256 tlsv12 - 18.193.17.109 - - "%ef%b5%bd%8" 2024-01-02T23:58:58
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="6">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-6" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-6" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-6.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>The snippet above represents a&nbsp;sample of&nbsp;the log data residing within the S3 bucket. Understanding data&rsquo;s format and content will help us&nbsp;to&nbsp;build an&nbsp;efficient strategy to&nbsp;parse and store it.</p>
<p>Let&rsquo;s move this data to&nbsp;DoubleCloud&rsquo;s Managed ClickHouse.</p></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><h2 id="setup-vpc-and-clickhouse-at-doublecloud"><a href="analyze-your-anlb-logs-with-clickhouse.html#setup-vpc-and-clickhouse-at-doublecloud" class="yfm-anchor" aria-hidden="true"><span class="visually-hidden">Setup VPC and ClickHouse at&nbsp;DoubleCloud</span></a>Setup VPC and ClickHouse at&nbsp;DoubleCloud</h2>
<p>Next, DoubleCloud comes to&nbsp;our rescue. We&nbsp;will add VPC (Virtual Private Cloud) and managed ClickHouse to&nbsp;serve as&nbsp;the dedicated storages for our logs.</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/network.tf#L1-L7">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "doublecloud_network" "nlb-network" {
  project_id      = var.project_id
  name            = var.network_name
  region_id       = var.region
  cloud_type      = var.cloud_type
  ipv4_cidr_block = var.ipv4_cidr
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="9">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-9" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-9" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-9.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Let&rsquo;s proceed by&nbsp;illustrating the integration of&nbsp;VPC and ClickHouse within this setup for our log storage. Let&rsquo;s create an&nbsp;instance of&nbsp;ClickHouse within the VPC:</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/ch.tf#L1-L35">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "doublecloud_clickhouse_cluster" "nlb-logs-clickhouse-cluster" {
  project_id = var.project_id
  name       = var.clickhouse_cluster_name
  region_id  = var.region
  cloud_type = var.cloud_type
  network_id = resource.doublecloud_network.nlb-network.id

  resources {
    clickhouse {
      resource_preset_id = var.clickhouse_cluster_resource_preset
      disk_size          = 34359738368
      replica_count      = 1
    }
  }

  config {
    log_level       = "LOG_LEVEL_INFORMATION"
    max_connections = 120
  }

  access {
    data_services = ["transfer"]
    ipv4_cidr_blocks = [
      {
        value       = var.ipv4_cidr
        description = "VPC CIDR"
      }
    ]
  }
}

data "doublecloud_clickhouse" "nlb-logs-clickhouse" {
  project_id = var.project_id
  id         = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="16">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-16" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-16" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-16.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"><div class="bc-layout__item"><div class="pc-card-base-block pc-card-base-block_border_shadow pc-background-card pc-background-card_padding_l pc-background-card_theme_default"><div class="pc-card-base-block__body"><div class="pc-card-base-block__content pc-background-card__content"><div class="pc-storage-background-image pc-background-card__image" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/doublecloud/cards/card-service-clickhouse-v3.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/doublecloud/cards/card-service-clickhouse-v3.png" class="pc-storage-background-image__img"/></picture></div><div class="col  col-12 col-md-12 col-reset pc-content pc-content_size_s pc-content_theme_default pc-content_control-position_default"><div class="pc-title pc-content__title" id="g-uniq-597267"><div class="col  col-12 col-reset"><h3 class="pc-title-item pc-title-item_size_s pc-title-item_reset-margin" data-qa="undefined-header"><span class="pc-title-item__text">Managed Service for ClickHouse</span></h3></div></div><div class="pc-content__text"><div class="yfm yfm_constructor yfm_constructor_size_s"><p>Fully managed service from the creators of&nbsp;the world&rsquo;s 1st managed ClickHouse. Backups, 24/7 monitoring, auto-scaling, and updates.</p></div></div><div class="pc-buttons pc-buttons_size_s pc-content__buttons pc-content__buttons_size_s"><a aria-describedby="g-uniq-597267" class="g-button g-button_view_action g-button_size_l g-button_pin_round-round pc-button-block pc-button-block_size_m pc-button-block_theme_action pc-buttons__button" href="../../../../services/managed-clickhouse.html" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Learn more</span></span></span></a></div></div></div></div></div></div></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><h2 id="connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud"><a href="analyze-your-anlb-logs-with-clickhouse.html#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud" class="yfm-anchor" aria-hidden="true"><span class="visually-hidden">Connect ClickHouse with S3 Logs via Transfer at&nbsp;DoubleCloud</span></a>Connect ClickHouse with S3 Logs via Transfer at&nbsp;DoubleCloud</h2>
<p>To&nbsp;connect S3 with ClickHouse, we&rsquo;ll use DoubleCloud&rsquo;s Transfer service, which is&nbsp;a&nbsp;powerful ELT tool.</p>
<p>Establishing a&nbsp;DoubleCloud Transfer (ELT pipeline) involves setting up&nbsp;a&nbsp;source and target endpoint. The Terraform code snippet below outlines the source endpoint:</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L1-L197">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "doublecloud_transfer_endpoint" "nlb-s3-s32ch-source" {
  name       = var.transfer_source_name
  project_id = var.project_id
  settings {
    object_storage_source {
      provider {
        bucket                = var.bucket_name
        path_prefix           = var.bucket_prefix
        aws_access_key_id     = var.aws_access_key_id
        aws_secret_access_key = var.aws_access_key_secret
        region                = var.region
        endpoint              = var.endpoint
        use_ssl               = true
        verify_ssl_cert       = true
      }
      format {
        csv {
          delimiter = " " // space as delimiter
          advanced_options {
          }
          additional_options {
          }
        }
      }
      event_source {
        sqs {
          queue_name = var.sqs_name
        }
      }
      result_table {
        add_system_cols = true
        table_name      = var.transfer_source_table_name
        table_namespace = var.transfer_source_table_namespace
      }
      result_schema {
        data_schema {
          fields {
            field {
              name     = "type"
              type     = "string"
              required = false
              key      = false
              path     = "0"
            }
            field {
              name     = "version"
              type     = "string"
              required = false
              key      = false
              path     = "1"
            }
            /*
              Rest of Fields
            */
            field {
              name     = "tls_connection_creation_time"
              type     = "datetime"
              required = false
              key      = false
              path     = "21"
            }
          }
        }
      }
    }
  }
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="12">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-12" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-12" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-12.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>This Terraform code snippet delineates the source endpoint configuration, encompassing S3 connection details, data format, event notifications using an&nbsp;SQS queue, and the schema definition for data stored within the S3 bucket.</p>
<p>Once we&nbsp;have a&nbsp;source, let&rsquo;s make a&nbsp;target. It&nbsp;easier, since it&rsquo;s just a&nbsp;ClickHouse:</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L199-L215">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "doublecloud_transfer_endpoint" "nlb-ch-s32ch-target" {
  name       = var.transfer_target_name
  project_id = var.project_id
  settings {
    clickhouse_target {
      clickhouse_cleanup_policy = "DROP"
      connection {
        address {
          cluster_id = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id
        }
        database = "default"
        password = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.password
        user     = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.user
      }
    }
  }
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="22">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-22" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-22" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-22.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>These two pieces can then be&nbsp;composed into a&nbsp;transfer:</p>
<p><a href="https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L217-L224">Click to&nbsp;view an&nbsp;example on&nbsp;Github</a></p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">resource "doublecloud_transfer" "nlb-logs-s32ch" {
  name       = var.transfer_name
  project_id = var.project_id
  source     = doublecloud_transfer_endpoint.nlb-s3-s32ch-source.id
  target     = doublecloud_transfer_endpoint.nlb-ch-s32ch-target.id
  type       = "INCREMENT_ONLY"
  activated  = false
}
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="29">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-29" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-29" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-29.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Once the transfer has been established, a&nbsp;comprehensive delivery pipeline takes shape:</p></div></section></div></div><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-media-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l bc-media__container"><div class="bc-media__border" data-qa="blog-media-content"><div class="pc-Media bc-media__content"><picture><source srcSet="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-3.png.webp" type="image/webp"/><img alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-3.png" class="pc-media-component-image__item bc-media__image"/></picture></div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"><div class="bc-layout__item"><div class="pc-card-base-block pc-card-base-block_border_shadow pc-background-card pc-background-card_padding_l pc-background-card_theme_default"><div class="pc-card-base-block__body"><div class="pc-card-base-block__content pc-background-card__content"><div class="pc-storage-background-image pc-background-card__image" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/doublecloud/cards/card-service-transfer-v3.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/doublecloud/cards/card-service-transfer-v3.png" class="pc-storage-background-image__img"/></picture></div><div class="col  col-12 col-md-12 col-reset pc-content pc-content_size_s pc-content_theme_default pc-content_control-position_default"><div class="pc-title pc-content__title" id="g-uniq-597269"><div class="col  col-12 col-reset"><h3 class="pc-title-item pc-title-item_size_s pc-title-item_reset-margin" data-qa="undefined-header"><span class="pc-title-item__text">No-code ELT tool: Data Transfer</span></h3></div></div><div class="pc-content__text"><div class="yfm yfm_constructor yfm_constructor_size_s"><p>A&nbsp;cloud agnostic service for aggregating, collecting, and migrating data from various sources.</p></div></div><div class="pc-buttons pc-buttons_size_s pc-content__buttons pc-content__buttons_size_s"><a aria-describedby="g-uniq-597269" class="g-button g-button_view_action g-button_size_l g-button_pin_round-round pc-button-block pc-button-block_size_m pc-button-block_theme_action pc-buttons__button" href="../../../../services/doublecloud-transfer.html" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Learn more</span></span></span></a></div></div></div></div></div></div></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"></section></div></div><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-media-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l bc-media__container"><div class="bc-media__border" data-qa="blog-media-content"><div class="pc-Media bc-media__content"><picture><source srcSet="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2-screenshot.png.webp" type="image/webp"/><img alt="" src="../../../../assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2-screenshot.png" class="pc-media-component-image__item bc-media__image"/></picture></div></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-layout-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_xs"><div class="row bc-layout__row no-gutter"><div class="col  col-12 col-lg-8  order-3 order-lg-1 bc-layout__left-col"><div class="bc-layout__item"><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-yfm-block"><section class="bc-wrapper bc-wrapper_padding-top_xs bc-wrapper_padding-bottom_l"><div class="yfm yfm_blog yfm_reset_paddings yfm_no-list-reset"><p>The illustration above represents the culmination of&nbsp;our efforts&nbsp;&mdash; a&nbsp;complete delivery pipeline primed for seamless data flow. This integrated system, incorporating S3, SQS, VPC, ClickHouse, and the orchestrated configurations, stands ready to&nbsp;handle, process, and analyze log data efficiently and effectively at&nbsp;any scale.</p>
<h2 id="looking-into-logs"><a href="analyze-your-anlb-logs-with-clickhouse.html#looking-into-logs" class="yfm-anchor" aria-hidden="true"><span class="visually-hidden">Looking into logs</span></a>Looking into logs</h2>
<p>Now, it&rsquo;s time to&nbsp;explore your data in&nbsp;ClickHouse. Let&rsquo;s dive into querying your structured logs and uncover insights within this robustly organized dataset. To&nbsp;connect to&nbsp;your newly create DB&nbsp;you can use clickhouse-client:</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">clickhouse-client \\
  --host $CH_HOST \\
  --port 9440 \\
  --secure \\
  --user admin \\
  --password $CH_PASSWORD
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="9">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-9" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-9" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-9.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Let&rsquo;s start by&nbsp;getting an&nbsp;overview of&nbsp;the total count of&nbsp;logs. This simple query will provide us&nbsp;with an&nbsp;initial grasp of&nbsp;the volume of&nbsp;data we&rsquo;re working on&nbsp;within our ClickHouse dataset:</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">SELECT count(*)
FROM logs_alb

Query id: 6cf59405-2a61-451b-9579-a7d340c8fd5c

┌──count()─┐
│ 15935887 │
└──────────┘

1 row in set. Elapsed: 0.457 sec.
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="13">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-13" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-13" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-13.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Now, let&rsquo;s zoom in&nbsp;and retrieve a&nbsp;specific row from our dataset. This targeted query will fetch a&nbsp;single record, allowing us&nbsp;to&nbsp;closely examine the details encapsulated within this individual log entry.</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">SELECT *
FROM logs_alb
LIMIT 1
FORMAT Vertical

Query id: 44fc6045-a5be-47e2-8482-3033efb58206

Row 1:
──────
type:                         tls
version:                      2.0
time:                         2023-11-20 21:05:01
elb:                          net/*****/*****
listener:                     92143215dc51bb35
client_port:                  10.0.246.57:55534
destination_port:             10.0.39.32:443
connection_time:              1
tls_handshake_time:           -
received_bytes:               0
sent_bytes:                   0
incoming_tls_alert:           -
chosen_cert_arn:              -
chosen_cert_serial:           -
tls_cipher:                   -
tls_protocol_version:         -
tls_named_group:              -
domain_name:                  -
alpn_fe_protocol:             -
alpn_be_protocol:             -
alpn_client_preference_list:  -
tls_connection_creation_time: 2023-11-20 21:05:01
__file_name:                  api/AWSLogs/******/elasticloadbalancing/eu-central-1/2023/11/20/****-central-1_net.****.log.gz
__row_index:                  1
__data_transfer_commit_time:  1700514476000000000
__data_transfer_delete_time:  0

1 row in set. Elapsed: 0.598 sec.
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="17">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-17" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-17" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-17.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Time for a&nbsp;quick analysis: let&rsquo;s execute a&nbsp;straightforward group by&nbsp;query to&nbsp;determine the most frequently used destination ports.</p>

    <div class="yfm-clipboard">
    <pre><code class="hljs">SELECT
    destination_port,
    count(*)
FROM logs_alb
GROUP BY destination_port

Query id: a4ab55db-9208-484f-b019-a5c13d779063

┌─destination_port──┬─count()─┐
│ 10.0.234.156:443  │   10148 │
│ 10.0.205.254:443  │   12639 │
│ 10.0.209.51:443   │   13586 │
│ 10.0.223.207:443  │   10125 │
│ 10.0.39.32:443    │ 4860701 │
│ 10.0.198.39:443   │   13837 │
│ 10.0.224.240:443  │    9546 │
│ 10.10.162.244:443 │  416893 │
│ 10.0.212.130:443  │    9955 │
│ 10.0.106.172:443  │ 4860359 │
│ 10.10.111.92:443  │  416908 │
│ 10.0.204.18:443   │    9789 │
│ 10.10.24.126:443  │  416881 │
│ 10.0.232.19:443   │   13603 │
│ 10.0.146.100:443  │ 4862200 │
└───────────────────┴─────────┘

15 rows in set. Elapsed: 1.101 sec. Processed 15.94 million rows, 405.01 MB (14.48 million rows/s., 368.01 MB/s.)
</code></pre>

    <svg width="16" height="16" viewBox="0 0 24 24" class="yfm-clipboard-button" data-animation="21">
        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path>
        <path stroke="currentColor" fill="transparent" stroke-width="1.5" d="M9.5 13l3 3l5 -5" visibility="hidden">
            <animate id="visibileAnimation-21" attributeName="visibility" from="hidden" to="visible" dur="0.2s" fill="freeze" begin></animate>
            <animate id="hideAnimation-21" attributeName="visibility" from="visible" to="hidden" dur="1s" begin="visibileAnimation-21.end+1" fill="freeze"></animate>
        </path>
    </svg>
    </div>
<p>Explore the complete example in&nbsp;our <a href="https://github.com/doublecloud/terraform-provider-doublecloud/tree/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack">Terraform project</a> for a&nbsp;hands-on experience with log querying in&nbsp;ClickHouse.</p></div></section></div></div></div><div class="col  col-12 col-lg-3  offset-0 offset-lg-1  order-2 order-lg-2 bc-layout__right-col"></div></div></section></div><div class="col col-reset pc-block-base pc-block-base_indentTop_l pc-block-base_indentBottom_l pc-constructor-block pc-constructor-block_type_content-layout-block"><div class="pc-content-layout-block pc-content-layout-block_size_l pc-content-layout-block_theme_default pc-content-layout-block_background"><div class="col  col-12 col-md-8 col-reset pc-content pc-content_size_l pc-content_centered pc-content_theme_default pc-content-layout-block__content"><div class="pc-title pc-content__title" id="g-uniq-597271"><div class="col  col-12 col-reset"><h2 class="pc-title-item pc-title-item_size_m pc-title-item_reset-margin" data-qa="undefined-header"><span class="pc-title-item__text">Get started with DoubleCloud</span></h2></div></div><div class="pc-buttons pc-buttons_size_l pc-content__buttons pc-content__buttons_size_l"><a aria-describedby="g-uniq-597271" class="g-button g-button_view_action g-button_size_xl g-button_pin_round-round pc-button-block pc-button-block_size_xl pc-button-block_theme_accent pc-buttons__button" href="https://auth.double.cloud/s/signup" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Start free trial</span></span></span></a><a aria-describedby="g-uniq-597271" class="g-button g-button_view_outlined g-button_size_xl g-button_pin_round-round pc-button-block pc-button-block_size_xl pc-button-block_theme_pseudo pc-buttons__button" href="analyze-your-anlb-logs-with-clickhouse.html#contact-us-form" aria-disabled="false"><span class="g-button__text"><span class="pc-button-block__content"><span class="pc-button-block__text">Contact us</span></span></span></a></div></div><div class="pc-content-layout-block__background"><div class="pc-storage-background-image pc-content-layout-block__background-item" style="background-color:#CA1551" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/doublecloud/doublecloud-cover-5.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/doublecloud/doublecloud-cover-5.png" class="pc-storage-background-image__img" style="background-color:#CA1551"/></picture></div></div></div></div><div class="col col-reset pc-block-base pc-block-base_reset-paddings pc-block-base_indentTop_0 pc-block-base_indentBottom_0 pc-constructor-block pc-constructor-block_type_blog-suggest-block"><section class="bc-wrapper bc-wrapper_padding-top_l bc-wrapper_padding-bottom_l"><div class="pc-SliderBlock"><div class="pc-title pc-SliderBlock__header pc-SliderBlock__header_no-description"><div class="col  col-12 col-sm-8 col-reset"><h2 class="pc-title-item pc-title-item_size_m pc-title-item_reset-margin" data-qa="undefined-header"><span class="pc-title-item__text">See also</span></h2></div></div><div class="pc-SliderBlock__animate-slides"><span style="font-size:0"></span><div><div class="slick-slider pc-slick-origin slick-initialized"><div class="slick-list"><div class="slick-track" style="width:100%;left:0%"><div data-index="0" class="slick-slide slick-active slick-current" tabindex="-1" aria-hidden="false" style="outline:none;width:33.333333333333336%"><div><div class="link" data-link-type="router"><a draggable="false" aria-labelledby="g-uniq-597272" aria-describedby="g-uniq-597273 g-uniq-597274 g-uniq-597276" class="g-link g-link_view_normal pc-card-base-block pc-card-base-block_border_shadow bc-post-card__card" href="../../2023/07/unifying-real-time-data-processing-kafka-spark-and-clickhouse.html"><div class="pc-storage-background-image pc-card-base-block__header bc-post-card__header" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/blog/articles/unifying-real-time-data-processing-kafka-spark-and-clickhouse-cover.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/blog/articles/unifying-real-time-data-processing-kafka-spark-and-clickhouse-cover.png" class="pc-storage-background-image__img"/></picture><div class="pc-storage-background-image__container"><div class="pc-card-base-block__header-content"><div class="bc-post-card__image-container" data-qa="blog-suggest-header"></div></div></div></div><div class="pc-card-base-block__body"><div class="pc-card-base-block__content"><h3 class="bc-post-card__title bc-post-card__title_size_s"><span><span id="g-uniq-597272">Unifying real-time data processing: Kafka, Spark, and ClickHouse</span></span></h3><span class="yfm yfm_blog_card bc-post-card__description" id="g-uniq-597273">Written by: Amos Gutman, DoubleCloud Senior Solution Architect</span></div><div class="pc-card-base-block__footer"><div class="bc-post-info__container"><div class="bc-post-info__suggest-container"><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597274">July 17, 2023</div><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597276"><span class="bc-post-info__icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" class="g-icon bc-post-info__icon-color" fill="currentColor" stroke="none" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16.004a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm3.357-3.736a1 1 0 0 0-.342-1.372L9 7.688V5.004a1 1 0 0 0-2 0v3.25a1 1 0 0 0 .486.857l2.5 1.5a1 1 0 0 0 1.371-.343Z"></path></svg></svg></span>10 mins to read</div></div></div></div></div></a></div></div></div><div data-index="1" class="slick-slide slick-active" tabindex="-1" aria-hidden="false" style="outline:none;width:33.333333333333336%"><div><div class="link" data-link-type="router"><a draggable="false" aria-labelledby="g-uniq-597277" aria-describedby="g-uniq-597279 g-uniq-597281" class="g-link g-link_view_normal pc-card-base-block pc-card-base-block_border_shadow bc-post-card__card" href="../../2023/07/clickhouse-use-cases.html"><div class="pc-storage-background-image pc-card-base-block__header bc-post-card__header" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/blog/articles/clickhouse-usecases-small-cover.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/blog/articles/clickhouse-usecases-small-cover.png" class="pc-storage-background-image__img"/></picture><div class="pc-storage-background-image__container"><div class="pc-card-base-block__header-content"><div class="bc-post-card__image-container" data-qa="blog-suggest-header"></div></div></div></div><div class="pc-card-base-block__body"><div class="pc-card-base-block__content"><h3 class="bc-post-card__title bc-post-card__title_size_s"><span><span id="g-uniq-597277">ClickHouse use cases: Revolutionizing data analysis</span></span></h3></div><div class="pc-card-base-block__footer"><div class="bc-post-info__container"><div class="bc-post-info__suggest-container"><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597279">July 11, 2023</div><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597281"><span class="bc-post-info__icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" class="g-icon bc-post-info__icon-color" fill="currentColor" stroke="none" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16.004a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm3.357-3.736a1 1 0 0 0-.342-1.372L9 7.688V5.004a1 1 0 0 0-2 0v3.25a1 1 0 0 0 .486.857l2.5 1.5a1 1 0 0 0 1.371-.343Z"></path></svg></svg></span>15 mins to read</div></div></div></div></div></a></div></div></div><div data-index="2" class="slick-slide slick-active" tabindex="-1" aria-hidden="false" style="outline:none;width:33.333333333333336%"><div><div class="link" data-link-type="router"><a draggable="false" aria-labelledby="g-uniq-597282" aria-describedby="g-uniq-597283 g-uniq-597284 g-uniq-597286" class="g-link g-link_view_normal pc-card-base-block pc-card-base-block_border_shadow bc-post-card__card" href="../02/kafka-and-clickhouse-unlocking-the-power-duo.html"><div class="pc-storage-background-image pc-card-base-block__header bc-post-card__header" data-qa="background-image"><picture data-qa="background-image-image"><source srcSet="../../../../assets/blog/articles/kafka-clickhouse-schema-cover.png.webp" type="image/webp" data-qa="background-image-image-desktop-source-compressed"/><img alt="" src="../../../../assets/blog/articles/kafka-clickhouse-schema-cover.png" class="pc-storage-background-image__img"/></picture><div class="pc-storage-background-image__container"><div class="pc-card-base-block__header-content"><div class="bc-post-card__image-container" data-qa="blog-suggest-header"></div></div></div></div><div class="pc-card-base-block__body"><div class="pc-card-base-block__content"><h3 class="bc-post-card__title bc-post-card__title_size_s"><span><span id="g-uniq-597282">Unlocking the power duo: Kafka and ClickHouse for lightning-fast data processing</span></span></h3><span class="yfm yfm_blog_card bc-post-card__description" id="g-uniq-597283">Written by: Andrei Tserakhau, DoubleCloud Tech Lead</span></div><div class="pc-card-base-block__footer"><div class="bc-post-info__container"><div class="bc-post-info__suggest-container"><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597284">February 21, 2024</div><div class="bc-post-info__item bc-post-info__item_size_s" id="g-uniq-597286"><span class="bc-post-info__icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" class="g-icon bc-post-info__icon-color" fill="currentColor" stroke="none" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16.004a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm3.357-3.736a1 1 0 0 0-.342-1.372L9 7.688V5.004a1 1 0 0 0-2 0v3.25a1 1 0 0 0 .486.857l2.5 1.5a1 1 0 0 0 1.371-.343Z"></path></svg></svg></span>15 mins to read</div></div></div></div></div></a></div></div></div></div></div></div><div class="pc-SliderBlock__footer"></div></div></div></div></section></div></div></div></div></div></main></div></div></div><div class="bc-prompt bc-prompt_close"><div class="bc-prompt__content"><span class="bc-prompt__text">Sign in to save this post</span><div class="bc-prompt__actions"><button class="g-button g-button_view_action g-button_size_l g-button_pin_round-round bc-prompt__action" type="button"><span class="g-button__text">Sign In</span></button></div></div></div></div><footer class="footer"><div class="pc-Grid"><div class="container-fluid "><div class="row"><div class="col  col-12 col-md-4 footer__column"><div class="link" data-link-type="router"><div class="logo footer__logo"><img alt="Logo Icon" src="../../../../assets/logo/dc-logo-dark.svg" width="178" height="36" decoding="async" data-nimg="future" class="logo__icon" loading="lazy" style="color:transparent"/><span class="logo__text"></span></div></div><div class="pc-Grid subscription-form-block"><div class="container-fluid "><div class="row subscription-form-block__container"><div class="col  col-12"><span class="subscription-form-block__header">Subscribe to our newsletter</span></div><div class="col  col-12"><div class="pc-hubspot-form pc-hubspot-form_theme_light" id="hubspot-form-b9015518-c7ea-4173-a96b-a251994635e3"></div></div><div class="col  col-12"><span class="subscription-form-block__footer">By submitting this form, you agree to our <a href="../../../../legal/privacy.html">Privacy policy</a></span></div></div></div></div></div><div class="col  col-6 col-sm-3 col-md-2 footer__column"><div class="footer__column-title">Products</div><a aria-label="Managed Service for ClickHouse®" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../services/managed-clickhouse.html"><div class="navigation-item"><span class="navigation-item__text">Managed Service for ClickHouse®</span></div></a><a aria-label="Managed Service for Apache Kafka®" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../services/managed-kafka.html"><div class="navigation-item"><span class="navigation-item__text">Managed Service for Apache Kafka®</span></div></a><a aria-label="Managed Service for Apache Airflow®" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../services/managed-airflow/index.html"><div class="navigation-item"><span class="navigation-item__text">Managed Service for Apache Airflow®</span></div></a><a aria-label="Data Transfer" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../services/doublecloud-transfer.html"><div class="navigation-item"><span class="navigation-item__text">Data Transfer</span></div></a><a aria-label="Data Visualization" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../services/doublecloud-visualization.html"><div class="navigation-item"><span class="navigation-item__text">Data Visualization</span></div></a></div><div class="col  col-6 col-sm-3 col-md-2 footer__column"><div class="footer__column-title">Solutions</div><a aria-label="Case studies" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../resources/case-studies/index.html"><div class="navigation-item"><span class="navigation-item__text">Case studies</span></div></a><a aria-label="Customer-facing analytics" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../customer-facing-analytics/index.html"><div class="navigation-item"><span class="navigation-item__text">Customer-facing analytics</span></div></a><a aria-label="Real-time analytics" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/real-time-analytics/index.html"><div class="navigation-item"><span class="navigation-item__text">Real-time analytics</span></div></a><a aria-label="Observability and monitoring" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/observability-and-monitoring/index.html"><div class="navigation-item"><span class="navigation-item__text">Observability and monitoring</span></div></a><a aria-label="AdTech and MarTech data analytics" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/adtech.html"><div class="navigation-item"><span class="navigation-item__text">AdTech and MarTech data analytics</span></div></a><a aria-label="Analytics for mobile and gaming Apps" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/web-mobile-gaming-apps.html"><div class="navigation-item"><span class="navigation-item__text">Analytics for mobile and gaming Apps</span></div></a><a aria-label="EdTech data analytics" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/edtech/index.html"><div class="navigation-item"><span class="navigation-item__text">EdTech data analytics</span></div></a><a aria-label="FinTech data analytics" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../solutions/fintech-real-time-analytics/index.html"><div class="navigation-item"><span class="navigation-item__text">FinTech data analytics</span></div></a></div><div class="col  col-6 col-sm-3 col-md-2 footer__column"><div class="footer__column-title">Resources</div><a aria-label="Documentation" class="navigation-item navigation-item_type_link footer__column-link" href="../../../../docs/index.html"><div class="navigation-item"><span class="navigation-item__text">Documentation</span></div></a><a aria-label="Webinars" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../webinars/index.html"><div class="navigation-item"><span class="navigation-item__text">Webinars</span></div></a><a aria-label="Blog" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../index.html"><div class="navigation-item navigation-item_selected"><span class="navigation-item__text">Blog</span></div></a><a href="https://join.slack.com/t/double-cloud/shared_invite/zt-1pbz9lfte-5GoIX~8CmVYqmVQfRFPNdA" aria-label="Slack" class="navigation-item navigation-item_type_link footer__column-link" target="_blank" rel="noopener noreferrer"><div class="navigation-item"><span class="navigation-item__text">Slack</span></div></a><a aria-label="Support" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../support/index.html"><div class="navigation-item"><span class="navigation-item__text">Support</span></div></a><a href="https://status.double.cloud/" aria-label="Status updates" class="navigation-item navigation-item_type_link footer__column-link" target="_blank" rel="noopener noreferrer"><div class="navigation-item"><span class="navigation-item__text">Status updates</span></div></a><a aria-label="Product comparisons" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../comparison/index.html"><div class="navigation-item"><span class="navigation-item__text">Product comparisons</span></div></a><a aria-label="Site map" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../sitemap/index.html"><div class="navigation-item"><span class="navigation-item__text">Site map</span></div></a></div><div class="col  col-6 col-sm-3 col-md-2 footer__column"><div class="footer__column-title">Company</div><a aria-label="About DoubleCloud" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../company/about-us.html"><div class="navigation-item"><span class="navigation-item__text">About DoubleCloud</span></div></a><a aria-label="Careers" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../company/careers.html"><div class="navigation-item"><span class="navigation-item__text">Careers</span></div></a><a aria-label="AWS Partnership" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../aws-partnership/index.html"><div class="navigation-item"><span class="navigation-item__text">AWS Partnership</span></div></a><a aria-label="Contact us" class="navigation-item navigation-item_type_link footer__column-link" data-link-type="router" href="../../../../company/contact-us.html"><div class="navigation-item"><span class="navigation-item__text">Contact us</span></div></a></div></div><div class="row"><div class="col  col-12 footer__underline"><div class="footer__underline-links"><a href="../../../../legal/customer_agreement/index.html" aria-label="Customer Agreement" class="navigation-item navigation-item_type_link footer__underline-link" target="_blank"><div class="navigation-item"><span class="navigation-item__text">Customer Agreement</span></div></a><a href="../../../../legal/privacy.html" aria-label="Privacy Policy" class="navigation-item navigation-item_type_link footer__underline-link" target="_blank"><div class="navigation-item"><span class="navigation-item__text">Privacy Policy</span></div></a><a aria-label="Pricing" class="navigation-item navigation-item_type_link footer__underline-link" data-link-type="router" href="../../../../pricing.html"><div class="navigation-item"><span class="navigation-item__text">Pricing</span></div></a><a href="../../../../security.html" aria-label="Security" class="navigation-item navigation-item_type_link footer__underline-link" target="_blank"><div class="navigation-item"><span class="navigation-item__text">Security</span></div></a></div><div class="footer__underline-copyright">© 2024 DoubleCloud</div></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json" nonce="gwgZFjTksMop1rFAK5zXCA==">{"props":{"pageProps":{"data":{"status":"fulfilled","pageContent":{"page":{"id":155,"name":"blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse","createdAt":"2024-08-21T09:46:48.323Z","updatedAt":"2024-08-21T09:46:48.323Z","type":"default","isDeleted":false,"versionOnTranslationId":null,"pageId":155,"locale":"en","publishedVersionId":2081,"lastVersionId":2082,"content":{"blocks":[{"type":"blog-header-block","resetPaddings":true,"paddingBottom":"l","width":"s","verticalOffset":"m","background":{"image":{"src":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-cover.png","disableCompress":true,"fetchPriority":"high"},"color":"#000000","fullWidth":false}},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"right","resetPaddings":true,"text":"\u003cp\u003eIn\u0026nbsp;this article, we\u0026rsquo;ll talk about:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\"\u003eSetup VPC and Clickhouse at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003eConnect Clickhouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#looking-into-logs\"\u003eLooking into logs\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"},{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003cp\u003eEnabling the power of\u0026nbsp;ClickHouse to\u0026nbsp;consolidate logs offers a\u0026nbsp;game-changing approach. It\u0026rsquo;s cost-effective, lightning-fast, and effortlessly scales to\u0026nbsp;accommodate your needs.\u003c/p\u003e\n\u003cp\u003eAWS stores Load Balancer Logs in\u0026nbsp;S3, employing a\u0026nbsp;queue system for a\u0026nbsp;seamless CDC (Change Data Capture) style delivery. This synergy between S3's queuing mechanism and ClickHouse lays a\u0026nbsp;robust foundation for efficient log analysis. And DoubleCloud makes this even easier with the power of\u0026nbsp;Transfer service.\u003c/p\u003e\n\u003cp\u003eWith Terraform at\u0026nbsp;your disposal, setting up\u0026nbsp;log aggregation becomes a\u0026nbsp;straightforward process.\u003c/p\u003e\n\u003ch2 id=\"lay-the-groundwork\"\u003e\u003ca href=\"#lay-the-groundwork\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLay the groundwork\u003c/span\u003e\u003c/a\u003eLay the groundwork\u003c/h2\u003e\n\u003cp\u003eSo, how do\u0026nbsp;you build the essential components for a\u0026nbsp;scalable and fast observability stack, dedicated to\u0026nbsp;dissecting and understanding AWS NLB or\u0026nbsp;ALB access logs?\u003c/p\u003e\n\u003cp\u003eTo\u0026nbsp;set the stage, envision a\u0026nbsp;baseline scenario\u0026nbsp;\u0026mdash; a\u0026nbsp;typical application setup incorporating an\u0026nbsp;AWS Load Balancer. As\u0026nbsp;a\u0026nbsp;fundamental part of\u0026nbsp;AWS services, Load Balancers funnel logs into an\u0026nbsp;S3 bucket. Now, let\u0026rsquo;s take a\u0026nbsp;guided tour through the step-by-step process, unveiling how these essential load-balancer logs seamlessly become accessible for real-time analysis in\u0026nbsp;ClickHouse, all orchestrated through Terraform.\u003c/p\u003e\n\u003cp\u003eBut before we\u0026nbsp;venture into the Terraform magic, it\u0026rsquo;s essential to\u0026nbsp;picture the existing infrastructure and the pivotal Terraform code that configures the seamless interplay between S3 and SQS for the ALB.\u003c/p\u003e"},{"type":"blog-media-block","column":"left","resetPaddings":true,"text":"","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1.png","fullWidth":false}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003ch2 id=\"s3-bucket-where-the-logs-are-stored-by-aws\"\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/span\u003e\u003c/a\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/h2\u003e\n\u003cp\u003eAt\u0026nbsp;the outset, our priority is\u0026nbsp;setting up\u0026nbsp;log storage for your ALB, a\u0026nbsp;crucial step that involves binding an\u0026nbsp;S3 bucket to\u0026nbsp;your existing ALB.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s kick off with the foundational element: the creation of\u0026nbsp;an\u0026nbsp;S3 Bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L1-L3\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket\" \"nlb_logs\" {\n  bucket = var.bucket_name\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis snippet lays the groundwork by\u0026nbsp;creating an\u0026nbsp;S3 bucket dedicated to\u0026nbsp;storing ALB logs, thereby serving as\u0026nbsp;a\u0026nbsp;repository for AWS ALB logs.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_lb\" \"alb\" {\n  /* your config\n  */\n\n  dynamic \"access_logs\" {\n    for_each = var.access_logs_bucket != null ? { enabled = true } : {}\n\n    content {\n      enabled = true\n      bucket  = var.bucket_name\n      prefix  = var.access_logs_bucket_prefix\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s move forward with setting up\u0026nbsp;the necessary configuration for an\u0026nbsp;SQS queue to\u0026nbsp;complement this S3 bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/sqs.tf#L1-L20\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_sqs_queue\" \"nlb_logs_queue\" {\n  name   = var.sqs_name\n  policy = \u0026lt;\u0026lt;POLICY\n{\n  \"Version\": \"2012-10-17\",\n  \"Id\": \"sqspolicy\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"sqs:SendMessage\",\n      \"Resource\": \"arn:aws:sqs:*:*:${var.sqs_name}\",\n      \"Condition\": {\n        \"ArnEquals\": { \"aws:SourceArn\": \"${aws_s3_bucket.nlb_logs.arn}\" }\n      }\n    }\n  ]\n}\nPOLICY\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"23\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-23\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-23\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-23.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis code initiates the creation of\u0026nbsp;an\u0026nbsp;SQS queue, facilitating the seamless delivery of\u0026nbsp;ALB logs to\u0026nbsp;the designated S3 bucket.\u003c/p\u003e\n\u003cp\u003eAs\u0026nbsp;logs are delivered, they are automatically organized within a\u0026nbsp;dedicated folder:\u003c/p\u003e"},{"type":"blog-media-block","column":"left","resetPaddings":true,"text":"","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-1-screenshot.png","fullWidth":false}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003cp\u003eRegularly generated new log files demand a\u0026nbsp;streamlined approach for notification and processing. To\u0026nbsp;establish a\u0026nbsp;seamless notification channel, we\u0026rsquo;ll configure an\u0026nbsp;optimal push notification system via\u0026nbsp;SQS. Referencing the guidelines outlined in\u0026nbsp;\u003ca href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html\"\u003eAmazon S3's notification configuration documentation\u003c/a\u003e, our next step involves the creation of\u0026nbsp;an\u0026nbsp;SQS queue. This queue will serve as\u0026nbsp;the conduit for receiving timely notifications, ensuring prompt handling and processing of\u0026nbsp;newly generated log files within our S3 bucket.\u003c/p\u003e\n\u003cp\u003eThis linkage is\u0026nbsp;solidified through the creation of\u0026nbsp;the SQS queue:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L54-L61\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket_notification\" \"nlb_logs_bucket_notification\" {\n  bucket = aws_s3_bucket.nlb_logs.id\n\n  queue {\n    queue_arn = aws_sqs_queue.nlb_logs_queue.arn\n    events    = [\"s3:ObjectCreated:*\"]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eAll the configurations implemented so\u0026nbsp;far serve as\u0026nbsp;the foundational infrastructure for streamlined log storage. From setting up\u0026nbsp;the S3 bucket to\u0026nbsp;configuring the SQS queue and establishing the intricate linkage between them, this orchestrated setup forms the backbone for efficient log management and processing:\u003c/p\u003e"},{"type":"blog-media-block","column":"left","resetPaddings":true,"text":"","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2.png","fullWidth":false}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003cp\u003eThe illustration above showcases the composed architecture, where the S3 bucket, SQS queue, and their interconnection stand as\u0026nbsp;pivotal components for storing and managing logs effectively within the AWS environment.\u003c/p\u003e\n\u003cp\u003eLogs are now in\u0026nbsp;your S3 bucket, but reading them may be\u0026nbsp;challenging. Lets take a\u0026nbsp;look at\u0026nbsp;a\u0026nbsp;data sample:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003etls 2.0 2024-01-02T23:58:58 net/preprod-public-api-dt-tls/9f8794be28ab2534 4d9af2ddde90eb82 84.247.112.144:33342 10.0.223.207:443 244 121 0 15 - arn:aws:acm:eu-central-1:840525340941:certificate/5240a1e4-c7fe-44c1-9d89-c256213c5d23 - ECDHE-RSA-AES128-GCM-SHA256 tlsv12 - 18.193.17.109 - - \"%ef%b5%bd%8\" 2024-01-02T23:58:58\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"6\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-6\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-6\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-6.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThe snippet above represents a\u0026nbsp;sample of\u0026nbsp;the log data residing within the S3 bucket. Understanding data\u0026rsquo;s format and content will help us\u0026nbsp;to\u0026nbsp;build an\u0026nbsp;efficient strategy to\u0026nbsp;parse and store it.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s move this data to\u0026nbsp;DoubleCloud\u0026rsquo;s Managed ClickHouse.\u003c/p\u003e"}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"background-card","column":"right","background":{"src":"/assets/doublecloud/cards/card-service-clickhouse-v3.png"},"paddingBottom":"l","title":"Managed Service for ClickHouse","text":"\u003cp\u003eFully managed service from the creators of\u0026nbsp;the world\u0026rsquo;s 1st managed ClickHouse. Backups, 24/7 monitoring, auto-scaling, and updates.\u003c/p\u003e","buttons":[{"text":"Learn more","theme":"action","url":"/services/managed-clickhouse/"}]},{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003ch2 id=\"setup-vpc-and-clickhouse-at-doublecloud\"\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eNext, DoubleCloud comes to\u0026nbsp;our rescue. We\u0026nbsp;will add VPC (Virtual Private Cloud) and managed ClickHouse to\u0026nbsp;serve as\u0026nbsp;the dedicated storages for our logs.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/network.tf#L1-L7\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_network\" \"nlb-network\" {\n  project_id      = var.project_id\n  name            = var.network_name\n  region_id       = var.region\n  cloud_type      = var.cloud_type\n  ipv4_cidr_block = var.ipv4_cidr\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s proceed by\u0026nbsp;illustrating the integration of\u0026nbsp;VPC and ClickHouse within this setup for our log storage. Let\u0026rsquo;s create an\u0026nbsp;instance of\u0026nbsp;ClickHouse within the VPC:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/ch.tf#L1-L35\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_clickhouse_cluster\" \"nlb-logs-clickhouse-cluster\" {\n  project_id = var.project_id\n  name       = var.clickhouse_cluster_name\n  region_id  = var.region\n  cloud_type = var.cloud_type\n  network_id = resource.doublecloud_network.nlb-network.id\n\n  resources {\n    clickhouse {\n      resource_preset_id = var.clickhouse_cluster_resource_preset\n      disk_size          = 34359738368\n      replica_count      = 1\n    }\n  }\n\n  config {\n    log_level       = \"LOG_LEVEL_INFORMATION\"\n    max_connections = 120\n  }\n\n  access {\n    data_services = [\"transfer\"]\n    ipv4_cidr_blocks = [\n      {\n        value       = var.ipv4_cidr\n        description = \"VPC CIDR\"\n      }\n    ]\n  }\n}\n\ndata \"doublecloud_clickhouse\" \"nlb-logs-clickhouse\" {\n  project_id = var.project_id\n  id         = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e"}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"background-card","column":"right","background":{"src":"/assets/doublecloud/cards/card-service-transfer-v3.png"},"paddingBottom":"l","title":"No-code ELT tool: Data Transfer","text":"\u003cp\u003eA\u0026nbsp;cloud agnostic service for aggregating, collecting, and migrating data from various sources.\u003c/p\u003e","buttons":[{"text":"Learn more","theme":"action","url":"/services/doublecloud-transfer/"}]},{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003ch2 id=\"connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eTo\u0026nbsp;connect S3 with ClickHouse, we\u0026rsquo;ll use DoubleCloud\u0026rsquo;s Transfer service, which is\u0026nbsp;a\u0026nbsp;powerful ELT tool.\u003c/p\u003e\n\u003cp\u003eEstablishing a\u0026nbsp;DoubleCloud Transfer (ELT pipeline) involves setting up\u0026nbsp;a\u0026nbsp;source and target endpoint. The Terraform code snippet below outlines the source endpoint:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L1-L197\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-s3-s32ch-source\" {\n  name       = var.transfer_source_name\n  project_id = var.project_id\n  settings {\n    object_storage_source {\n      provider {\n        bucket                = var.bucket_name\n        path_prefix           = var.bucket_prefix\n        aws_access_key_id     = var.aws_access_key_id\n        aws_secret_access_key = var.aws_access_key_secret\n        region                = var.region\n        endpoint              = var.endpoint\n        use_ssl               = true\n        verify_ssl_cert       = true\n      }\n      format {\n        csv {\n          delimiter = \" \" // space as delimiter\n          advanced_options {\n          }\n          additional_options {\n          }\n        }\n      }\n      event_source {\n        sqs {\n          queue_name = var.sqs_name\n        }\n      }\n      result_table {\n        add_system_cols = true\n        table_name      = var.transfer_source_table_name\n        table_namespace = var.transfer_source_table_namespace\n      }\n      result_schema {\n        data_schema {\n          fields {\n            field {\n              name     = \"type\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"0\"\n            }\n            field {\n              name     = \"version\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"1\"\n            }\n            /*\n              Rest of Fields\n            */\n            field {\n              name     = \"tls_connection_creation_time\"\n              type     = \"datetime\"\n              required = false\n              key      = false\n              path     = \"21\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis Terraform code snippet delineates the source endpoint configuration, encompassing S3 connection details, data format, event notifications using an\u0026nbsp;SQS queue, and the schema definition for data stored within the S3 bucket.\u003c/p\u003e\n\u003cp\u003eOnce we\u0026nbsp;have a\u0026nbsp;source, let\u0026rsquo;s make a\u0026nbsp;target. It\u0026nbsp;easier, since it\u0026rsquo;s just a\u0026nbsp;ClickHouse:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L199-L215\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-ch-s32ch-target\" {\n  name       = var.transfer_target_name\n  project_id = var.project_id\n  settings {\n    clickhouse_target {\n      clickhouse_cleanup_policy = \"DROP\"\n      connection {\n        address {\n          cluster_id = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n        }\n        database = \"default\"\n        password = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.password\n        user     = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.user\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"22\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-22\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-22\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-22.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThese two pieces can then be\u0026nbsp;composed into a\u0026nbsp;transfer:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L217-L224\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer\" \"nlb-logs-s32ch\" {\n  name       = var.transfer_name\n  project_id = var.project_id\n  source     = doublecloud_transfer_endpoint.nlb-s3-s32ch-source.id\n  target     = doublecloud_transfer_endpoint.nlb-ch-s32ch-target.id\n  type       = \"INCREMENT_ONLY\"\n  activated  = false\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"29\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-29\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-29\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-29.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eOnce the transfer has been established, a\u0026nbsp;comprehensive delivery pipeline takes shape:\u003c/p\u003e"},{"type":"blog-media-block","column":"left","resetPaddings":true,"text":"","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-3.png","fullWidth":false}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":""},{"type":"blog-media-block","column":"left","resetPaddings":true,"text":"","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-2-screenshot.png","fullWidth":false}]},{"type":"blog-layout-block","resetPaddings":true,"mobileOrder":"reverse","children":[{"type":"blog-yfm-block","column":"left","resetPaddings":true,"text":"\u003cp\u003eThe illustration above represents the culmination of\u0026nbsp;our efforts\u0026nbsp;\u0026mdash; a\u0026nbsp;complete delivery pipeline primed for seamless data flow. This integrated system, incorporating S3, SQS, VPC, ClickHouse, and the orchestrated configurations, stands ready to\u0026nbsp;handle, process, and analyze log data efficiently and effectively at\u0026nbsp;any scale.\u003c/p\u003e\n\u003ch2 id=\"looking-into-logs\"\u003e\u003ca href=\"#looking-into-logs\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLooking into logs\u003c/span\u003e\u003c/a\u003eLooking into logs\u003c/h2\u003e\n\u003cp\u003eNow, it\u0026rsquo;s time to\u0026nbsp;explore your data in\u0026nbsp;ClickHouse. Let\u0026rsquo;s dive into querying your structured logs and uncover insights within this robustly organized dataset. To\u0026nbsp;connect to\u0026nbsp;your newly create DB\u0026nbsp;you can use clickhouse-client:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eclickhouse-client \\\\\n  --host $CH_HOST \\\\\n  --port 9440 \\\\\n  --secure \\\\\n  --user admin \\\\\n  --password $CH_PASSWORD\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s start by\u0026nbsp;getting an\u0026nbsp;overview of\u0026nbsp;the total count of\u0026nbsp;logs. This simple query will provide us\u0026nbsp;with an\u0026nbsp;initial grasp of\u0026nbsp;the volume of\u0026nbsp;data we\u0026rsquo;re working on\u0026nbsp;within our ClickHouse dataset:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT count(*)\nFROM logs_alb\n\nQuery id: 6cf59405-2a61-451b-9579-a7d340c8fd5c\n\n┌──count()─┐\n│ 15935887 │\n└──────────┘\n\n1 row in set. Elapsed: 0.457 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"13\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-13\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-13\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-13.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s zoom in\u0026nbsp;and retrieve a\u0026nbsp;specific row from our dataset. This targeted query will fetch a\u0026nbsp;single record, allowing us\u0026nbsp;to\u0026nbsp;closely examine the details encapsulated within this individual log entry.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT *\nFROM logs_alb\nLIMIT 1\nFORMAT Vertical\n\nQuery id: 44fc6045-a5be-47e2-8482-3033efb58206\n\nRow 1:\n──────\ntype:                         tls\nversion:                      2.0\ntime:                         2023-11-20 21:05:01\nelb:                          net/*****/*****\nlistener:                     92143215dc51bb35\nclient_port:                  10.0.246.57:55534\ndestination_port:             10.0.39.32:443\nconnection_time:              1\ntls_handshake_time:           -\nreceived_bytes:               0\nsent_bytes:                   0\nincoming_tls_alert:           -\nchosen_cert_arn:              -\nchosen_cert_serial:           -\ntls_cipher:                   -\ntls_protocol_version:         -\ntls_named_group:              -\ndomain_name:                  -\nalpn_fe_protocol:             -\nalpn_be_protocol:             -\nalpn_client_preference_list:  -\ntls_connection_creation_time: 2023-11-20 21:05:01\n__file_name:                  api/AWSLogs/******/elasticloadbalancing/eu-central-1/2023/11/20/****-central-1_net.****.log.gz\n__row_index:                  1\n__data_transfer_commit_time:  1700514476000000000\n__data_transfer_delete_time:  0\n\n1 row in set. Elapsed: 0.598 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"17\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-17\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-17\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-17.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eTime for a\u0026nbsp;quick analysis: let\u0026rsquo;s execute a\u0026nbsp;straightforward group by\u0026nbsp;query to\u0026nbsp;determine the most frequently used destination ports.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT\n    destination_port,\n    count(*)\nFROM logs_alb\nGROUP BY destination_port\n\nQuery id: a4ab55db-9208-484f-b019-a5c13d779063\n\n┌─destination_port──┬─count()─┐\n│ 10.0.234.156:443  │   10148 │\n│ 10.0.205.254:443  │   12639 │\n│ 10.0.209.51:443   │   13586 │\n│ 10.0.223.207:443  │   10125 │\n│ 10.0.39.32:443    │ 4860701 │\n│ 10.0.198.39:443   │   13837 │\n│ 10.0.224.240:443  │    9546 │\n│ 10.10.162.244:443 │  416893 │\n│ 10.0.212.130:443  │    9955 │\n│ 10.0.106.172:443  │ 4860359 │\n│ 10.10.111.92:443  │  416908 │\n│ 10.0.204.18:443   │    9789 │\n│ 10.10.24.126:443  │  416881 │\n│ 10.0.232.19:443   │   13603 │\n│ 10.0.146.100:443  │ 4862200 │\n└───────────────────┴─────────┘\n\n15 rows in set. Elapsed: 1.101 sec. Processed 15.94 million rows, 405.01 MB (14.48 million rows/s., 368.01 MB/s.)\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"21\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-21\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-21\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-21.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eExplore the complete example in\u0026nbsp;our \u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/tree/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack\"\u003eTerraform project\u003c/a\u003e for a\u0026nbsp;hands-on experience with log querying in\u0026nbsp;ClickHouse.\u003c/p\u003e"}]},{"type":"content-layout-block","background":{"src":"/assets/doublecloud/doublecloud-cover-5.png","style":{"backgroundColor":"#CA1551"}},"centered":true,"textContent":{"title":"Get started with DoubleCloud","buttons":[{"text":"Start free trial","size":"promo","theme":"accent","url":"https://auth.double.cloud/s/signup"},{"text":"Contact us","theme":"pseudo","url":"#contact-us-form"}]}},{"type":"blog-suggest-block","resetPaddings":true,"fullWidth":false}]},"title":"Analyze your {A|N}LB logs with ClickHouse","noIndex":false,"shareTitle":null,"shareDescription":null,"shareImage":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png","pageLocaleId":310,"author":"unknown","metaDescription":"Learn how to efficiently analyze your ALB/NLB logs with ClickHouse. This guide covers storing logs in an S3 bucket, setting up VPC and ClickHouse at DoubleCloud, connecting ClickHouse with S3 logs via Transfer at DoubleCloud, and delving into log analysis.\"","keywords":[],"shareGenTitle":null,"canonicalLink":null,"sharingType":"custom","sharingTheme":"light","comment":"add fetchProperty prop to header or bg","shareImageUrl":null,"pageRegionId":null,"service":null,"solution":null,"locales":[{"locale":"ru","publishedVersionId":null},{"locale":"en","publishedVersionId":2081}],"regions":[],"pageRegions":[]},"post":{"url":"","id":155,"name":"analyze-your-anlb-logs-with-clickhouse","isPinned":false,"blogPostId":155,"image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-small-cover.png","readingTime":15,"date":"2024-05-24T00:00:00Z","likes":0,"hasUserLike":false,"services":[],"slug":"","authors":[],"locale":{"lang":"en"},"textTitle":"Analyze your {A|N}LB logs with ClickHouse","htmlTitle":"Analyze your {A|N}LB logs with ClickHouse","title":"Analyze your {A|N}LB logs with ClickHouse","tags":[{"icon":null,"slug":"insights","name":"Insights","createdAt":"","updatedAt":"","count":0},{"icon":null,"slug":"ClickHouse","name":"ClickHouse","createdAt":"","updatedAt":"","count":0}],"metaTitle":"Analyze your {A|N}LB logs with ClickHouse","description":"\u003cp\u003eWritten by: Andrei Tserakhau, DoubleCloud Tech Lead\u003c/p\u003e","content":"\u003cp\u003eIn\u0026nbsp;this article, we\u0026rsquo;ll talk about:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\"\u003eSetup VPC and Clickhouse at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003eConnect Clickhouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#looking-into-logs\"\u003eLooking into logs\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEnabling the power of\u0026nbsp;ClickHouse to\u0026nbsp;consolidate logs offers a\u0026nbsp;game-changing approach. It\u0026rsquo;s cost-effective, lightning-fast, and effortlessly scales to\u0026nbsp;accommodate your needs.\u003c/p\u003e\n\u003cp\u003eAWS stores Load Balancer Logs in\u0026nbsp;S3, employing a\u0026nbsp;queue system for a\u0026nbsp;seamless CDC (Change Data Capture) style delivery. This synergy between S3's queuing mechanism and ClickHouse lays a\u0026nbsp;robust foundation for efficient log analysis. And DoubleCloud makes this even easier with the power of\u0026nbsp;Transfer service.\u003c/p\u003e\n\u003cp\u003eWith Terraform at\u0026nbsp;your disposal, setting up\u0026nbsp;log aggregation becomes a\u0026nbsp;straightforward process.\u003c/p\u003e\n\u003ch2 id=\"lay-the-groundwork\"\u003e\u003ca href=\"#lay-the-groundwork\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLay the groundwork\u003c/span\u003e\u003c/a\u003eLay the groundwork\u003c/h2\u003e\n\u003cp\u003eSo, how do\u0026nbsp;you build the essential components for a\u0026nbsp;scalable and fast observability stack, dedicated to\u0026nbsp;dissecting and understanding AWS NLB or\u0026nbsp;ALB access logs?\u003c/p\u003e\n\u003cp\u003eTo\u0026nbsp;set the stage, envision a\u0026nbsp;baseline scenario\u0026nbsp;\u0026mdash; a\u0026nbsp;typical application setup incorporating an\u0026nbsp;AWS Load Balancer. As\u0026nbsp;a\u0026nbsp;fundamental part of\u0026nbsp;AWS services, Load Balancers funnel logs into an\u0026nbsp;S3 bucket. Now, let\u0026rsquo;s take a\u0026nbsp;guided tour through the step-by-step process, unveiling how these essential load-balancer logs seamlessly become accessible for real-time analysis in\u0026nbsp;ClickHouse, all orchestrated through Terraform.\u003c/p\u003e\n\u003cp\u003eBut before we\u0026nbsp;venture into the Terraform magic, it\u0026rsquo;s essential to\u0026nbsp;picture the existing infrastructure and the pivotal Terraform code that configures the seamless interplay between S3 and SQS for the ALB.\u003c/p\u003e\n\n\u003ch2 id=\"s3-bucket-where-the-logs-are-stored-by-aws\"\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/span\u003e\u003c/a\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/h2\u003e\n\u003cp\u003eAt\u0026nbsp;the outset, our priority is\u0026nbsp;setting up\u0026nbsp;log storage for your ALB, a\u0026nbsp;crucial step that involves binding an\u0026nbsp;S3 bucket to\u0026nbsp;your existing ALB.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s kick off with the foundational element: the creation of\u0026nbsp;an\u0026nbsp;S3 Bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L1-L3\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket\" \"nlb_logs\" {\n  bucket = var.bucket_name\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis snippet lays the groundwork by\u0026nbsp;creating an\u0026nbsp;S3 bucket dedicated to\u0026nbsp;storing ALB logs, thereby serving as\u0026nbsp;a\u0026nbsp;repository for AWS ALB logs.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_lb\" \"alb\" {\n  /* your config\n  */\n\n  dynamic \"access_logs\" {\n    for_each = var.access_logs_bucket != null ? { enabled = true } : {}\n\n    content {\n      enabled = true\n      bucket  = var.bucket_name\n      prefix  = var.access_logs_bucket_prefix\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s move forward with setting up\u0026nbsp;the necessary configuration for an\u0026nbsp;SQS queue to\u0026nbsp;complement this S3 bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/sqs.tf#L1-L20\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_sqs_queue\" \"nlb_logs_queue\" {\n  name   = var.sqs_name\n  policy = \u0026lt;\u0026lt;POLICY\n{\n  \"Version\": \"2012-10-17\",\n  \"Id\": \"sqspolicy\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"sqs:SendMessage\",\n      \"Resource\": \"arn:aws:sqs:*:*:${var.sqs_name}\",\n      \"Condition\": {\n        \"ArnEquals\": { \"aws:SourceArn\": \"${aws_s3_bucket.nlb_logs.arn}\" }\n      }\n    }\n  ]\n}\nPOLICY\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"23\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-23\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-23\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-23.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis code initiates the creation of\u0026nbsp;an\u0026nbsp;SQS queue, facilitating the seamless delivery of\u0026nbsp;ALB logs to\u0026nbsp;the designated S3 bucket.\u003c/p\u003e\n\u003cp\u003eAs\u0026nbsp;logs are delivered, they are automatically organized within a\u0026nbsp;dedicated folder:\u003c/p\u003e\n\n\u003cp\u003eRegularly generated new log files demand a\u0026nbsp;streamlined approach for notification and processing. To\u0026nbsp;establish a\u0026nbsp;seamless notification channel, we\u0026rsquo;ll configure an\u0026nbsp;optimal push notification system via\u0026nbsp;SQS. Referencing the guidelines outlined in\u0026nbsp;\u003ca href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html\"\u003eAmazon S3's notification configuration documentation\u003c/a\u003e, our next step involves the creation of\u0026nbsp;an\u0026nbsp;SQS queue. This queue will serve as\u0026nbsp;the conduit for receiving timely notifications, ensuring prompt handling and processing of\u0026nbsp;newly generated log files within our S3 bucket.\u003c/p\u003e\n\u003cp\u003eThis linkage is\u0026nbsp;solidified through the creation of\u0026nbsp;the SQS queue:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L54-L61\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket_notification\" \"nlb_logs_bucket_notification\" {\n  bucket = aws_s3_bucket.nlb_logs.id\n\n  queue {\n    queue_arn = aws_sqs_queue.nlb_logs_queue.arn\n    events    = [\"s3:ObjectCreated:*\"]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eAll the configurations implemented so\u0026nbsp;far serve as\u0026nbsp;the foundational infrastructure for streamlined log storage. From setting up\u0026nbsp;the S3 bucket to\u0026nbsp;configuring the SQS queue and establishing the intricate linkage between them, this orchestrated setup forms the backbone for efficient log management and processing:\u003c/p\u003e\n\n\u003cp\u003eThe illustration above showcases the composed architecture, where the S3 bucket, SQS queue, and their interconnection stand as\u0026nbsp;pivotal components for storing and managing logs effectively within the AWS environment.\u003c/p\u003e\n\u003cp\u003eLogs are now in\u0026nbsp;your S3 bucket, but reading them may be\u0026nbsp;challenging. Lets take a\u0026nbsp;look at\u0026nbsp;a\u0026nbsp;data sample:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003etls 2.0 2024-01-02T23:58:58 net/preprod-public-api-dt-tls/9f8794be28ab2534 4d9af2ddde90eb82 84.247.112.144:33342 10.0.223.207:443 244 121 0 15 - arn:aws:acm:eu-central-1:840525340941:certificate/5240a1e4-c7fe-44c1-9d89-c256213c5d23 - ECDHE-RSA-AES128-GCM-SHA256 tlsv12 - 18.193.17.109 - - \"%ef%b5%bd%8\" 2024-01-02T23:58:58\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"6\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-6\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-6\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-6.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThe snippet above represents a\u0026nbsp;sample of\u0026nbsp;the log data residing within the S3 bucket. Understanding data\u0026rsquo;s format and content will help us\u0026nbsp;to\u0026nbsp;build an\u0026nbsp;efficient strategy to\u0026nbsp;parse and store it.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s move this data to\u0026nbsp;DoubleCloud\u0026rsquo;s Managed ClickHouse.\u003c/p\u003e\n\u003ch2 id=\"setup-vpc-and-clickhouse-at-doublecloud\"\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eNext, DoubleCloud comes to\u0026nbsp;our rescue. We\u0026nbsp;will add VPC (Virtual Private Cloud) and managed ClickHouse to\u0026nbsp;serve as\u0026nbsp;the dedicated storages for our logs.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/network.tf#L1-L7\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_network\" \"nlb-network\" {\n  project_id      = var.project_id\n  name            = var.network_name\n  region_id       = var.region\n  cloud_type      = var.cloud_type\n  ipv4_cidr_block = var.ipv4_cidr\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s proceed by\u0026nbsp;illustrating the integration of\u0026nbsp;VPC and ClickHouse within this setup for our log storage. Let\u0026rsquo;s create an\u0026nbsp;instance of\u0026nbsp;ClickHouse within the VPC:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/ch.tf#L1-L35\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_clickhouse_cluster\" \"nlb-logs-clickhouse-cluster\" {\n  project_id = var.project_id\n  name       = var.clickhouse_cluster_name\n  region_id  = var.region\n  cloud_type = var.cloud_type\n  network_id = resource.doublecloud_network.nlb-network.id\n\n  resources {\n    clickhouse {\n      resource_preset_id = var.clickhouse_cluster_resource_preset\n      disk_size          = 34359738368\n      replica_count      = 1\n    }\n  }\n\n  config {\n    log_level       = \"LOG_LEVEL_INFORMATION\"\n    max_connections = 120\n  }\n\n  access {\n    data_services = [\"transfer\"]\n    ipv4_cidr_blocks = [\n      {\n        value       = var.ipv4_cidr\n        description = \"VPC CIDR\"\n      }\n    ]\n  }\n}\n\ndata \"doublecloud_clickhouse\" \"nlb-logs-clickhouse\" {\n  project_id = var.project_id\n  id         = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eTo\u0026nbsp;connect S3 with ClickHouse, we\u0026rsquo;ll use DoubleCloud\u0026rsquo;s Transfer service, which is\u0026nbsp;a\u0026nbsp;powerful ELT tool.\u003c/p\u003e\n\u003cp\u003eEstablishing a\u0026nbsp;DoubleCloud Transfer (ELT pipeline) involves setting up\u0026nbsp;a\u0026nbsp;source and target endpoint. The Terraform code snippet below outlines the source endpoint:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L1-L197\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-s3-s32ch-source\" {\n  name       = var.transfer_source_name\n  project_id = var.project_id\n  settings {\n    object_storage_source {\n      provider {\n        bucket                = var.bucket_name\n        path_prefix           = var.bucket_prefix\n        aws_access_key_id     = var.aws_access_key_id\n        aws_secret_access_key = var.aws_access_key_secret\n        region                = var.region\n        endpoint              = var.endpoint\n        use_ssl               = true\n        verify_ssl_cert       = true\n      }\n      format {\n        csv {\n          delimiter = \" \" // space as delimiter\n          advanced_options {\n          }\n          additional_options {\n          }\n        }\n      }\n      event_source {\n        sqs {\n          queue_name = var.sqs_name\n        }\n      }\n      result_table {\n        add_system_cols = true\n        table_name      = var.transfer_source_table_name\n        table_namespace = var.transfer_source_table_namespace\n      }\n      result_schema {\n        data_schema {\n          fields {\n            field {\n              name     = \"type\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"0\"\n            }\n            field {\n              name     = \"version\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"1\"\n            }\n            /*\n              Rest of Fields\n            */\n            field {\n              name     = \"tls_connection_creation_time\"\n              type     = \"datetime\"\n              required = false\n              key      = false\n              path     = \"21\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis Terraform code snippet delineates the source endpoint configuration, encompassing S3 connection details, data format, event notifications using an\u0026nbsp;SQS queue, and the schema definition for data stored within the S3 bucket.\u003c/p\u003e\n\u003cp\u003eOnce we\u0026nbsp;have a\u0026nbsp;source, let\u0026rsquo;s make a\u0026nbsp;target. It\u0026nbsp;easier, since it\u0026rsquo;s just a\u0026nbsp;ClickHouse:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L199-L215\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-ch-s32ch-target\" {\n  name       = var.transfer_target_name\n  project_id = var.project_id\n  settings {\n    clickhouse_target {\n      clickhouse_cleanup_policy = \"DROP\"\n      connection {\n        address {\n          cluster_id = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n        }\n        database = \"default\"\n        password = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.password\n        user     = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.user\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"22\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-22\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-22\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-22.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThese two pieces can then be\u0026nbsp;composed into a\u0026nbsp;transfer:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L217-L224\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer\" \"nlb-logs-s32ch\" {\n  name       = var.transfer_name\n  project_id = var.project_id\n  source     = doublecloud_transfer_endpoint.nlb-s3-s32ch-source.id\n  target     = doublecloud_transfer_endpoint.nlb-ch-s32ch-target.id\n  type       = \"INCREMENT_ONLY\"\n  activated  = false\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"29\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-29\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-29\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-29.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eOnce the transfer has been established, a\u0026nbsp;comprehensive delivery pipeline takes shape:\u003c/p\u003e\n\n\n\n\u003cp\u003eThe illustration above represents the culmination of\u0026nbsp;our efforts\u0026nbsp;\u0026mdash; a\u0026nbsp;complete delivery pipeline primed for seamless data flow. This integrated system, incorporating S3, SQS, VPC, ClickHouse, and the orchestrated configurations, stands ready to\u0026nbsp;handle, process, and analyze log data efficiently and effectively at\u0026nbsp;any scale.\u003c/p\u003e\n\u003ch2 id=\"looking-into-logs\"\u003e\u003ca href=\"#looking-into-logs\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLooking into logs\u003c/span\u003e\u003c/a\u003eLooking into logs\u003c/h2\u003e\n\u003cp\u003eNow, it\u0026rsquo;s time to\u0026nbsp;explore your data in\u0026nbsp;ClickHouse. Let\u0026rsquo;s dive into querying your structured logs and uncover insights within this robustly organized dataset. To\u0026nbsp;connect to\u0026nbsp;your newly create DB\u0026nbsp;you can use clickhouse-client:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eclickhouse-client \\\\\n  --host $CH_HOST \\\\\n  --port 9440 \\\\\n  --secure \\\\\n  --user admin \\\\\n  --password $CH_PASSWORD\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s start by\u0026nbsp;getting an\u0026nbsp;overview of\u0026nbsp;the total count of\u0026nbsp;logs. This simple query will provide us\u0026nbsp;with an\u0026nbsp;initial grasp of\u0026nbsp;the volume of\u0026nbsp;data we\u0026rsquo;re working on\u0026nbsp;within our ClickHouse dataset:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT count(*)\nFROM logs_alb\n\nQuery id: 6cf59405-2a61-451b-9579-a7d340c8fd5c\n\n┌──count()─┐\n│ 15935887 │\n└──────────┘\n\n1 row in set. Elapsed: 0.457 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"13\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-13\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-13\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-13.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s zoom in\u0026nbsp;and retrieve a\u0026nbsp;specific row from our dataset. This targeted query will fetch a\u0026nbsp;single record, allowing us\u0026nbsp;to\u0026nbsp;closely examine the details encapsulated within this individual log entry.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT *\nFROM logs_alb\nLIMIT 1\nFORMAT Vertical\n\nQuery id: 44fc6045-a5be-47e2-8482-3033efb58206\n\nRow 1:\n──────\ntype:                         tls\nversion:                      2.0\ntime:                         2023-11-20 21:05:01\nelb:                          net/*****/*****\nlistener:                     92143215dc51bb35\nclient_port:                  10.0.246.57:55534\ndestination_port:             10.0.39.32:443\nconnection_time:              1\ntls_handshake_time:           -\nreceived_bytes:               0\nsent_bytes:                   0\nincoming_tls_alert:           -\nchosen_cert_arn:              -\nchosen_cert_serial:           -\ntls_cipher:                   -\ntls_protocol_version:         -\ntls_named_group:              -\ndomain_name:                  -\nalpn_fe_protocol:             -\nalpn_be_protocol:             -\nalpn_client_preference_list:  -\ntls_connection_creation_time: 2023-11-20 21:05:01\n__file_name:                  api/AWSLogs/******/elasticloadbalancing/eu-central-1/2023/11/20/****-central-1_net.****.log.gz\n__row_index:                  1\n__data_transfer_commit_time:  1700514476000000000\n__data_transfer_delete_time:  0\n\n1 row in set. Elapsed: 0.598 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"17\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-17\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-17\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-17.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eTime for a\u0026nbsp;quick analysis: let\u0026rsquo;s execute a\u0026nbsp;straightforward group by\u0026nbsp;query to\u0026nbsp;determine the most frequently used destination ports.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT\n    destination_port,\n    count(*)\nFROM logs_alb\nGROUP BY destination_port\n\nQuery id: a4ab55db-9208-484f-b019-a5c13d779063\n\n┌─destination_port──┬─count()─┐\n│ 10.0.234.156:443  │   10148 │\n│ 10.0.205.254:443  │   12639 │\n│ 10.0.209.51:443   │   13586 │\n│ 10.0.223.207:443  │   10125 │\n│ 10.0.39.32:443    │ 4860701 │\n│ 10.0.198.39:443   │   13837 │\n│ 10.0.224.240:443  │    9546 │\n│ 10.10.162.244:443 │  416893 │\n│ 10.0.212.130:443  │    9955 │\n│ 10.0.106.172:443  │ 4860359 │\n│ 10.10.111.92:443  │  416908 │\n│ 10.0.204.18:443   │    9789 │\n│ 10.10.24.126:443  │  416881 │\n│ 10.0.232.19:443   │   13603 │\n│ 10.0.146.100:443  │ 4862200 │\n└───────────────────┴─────────┘\n\n15 rows in set. Elapsed: 1.101 sec. Processed 15.94 million rows, 405.01 MB (14.48 million rows/s., 368.01 MB/s.)\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"21\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-21\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-21\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-21.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eExplore the complete example in\u0026nbsp;our \u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/tree/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack\"\u003eTerraform project\u003c/a\u003e for a\u0026nbsp;hands-on experience with log querying in\u0026nbsp;ClickHouse.\u003c/p\u003e\n"},"suggestedPosts":[{"url":"/blog/posts/2023/07/unifying-real-time-data-processing-kafka-spark-and-clickhouse","id":124,"name":"unifying-real-time-data-processing-kafka-spark-and-clickhouse","date":"2023-07-17T00:00:00Z","description":"Written by: Amos Gutman, DoubleCloud Senior Solution Architect","readingTime":10,"image":"/assets/blog/articles/unifying-real-time-data-processing-kafka-spark-and-clickhouse-cover.png","blogPostId":124,"likes":0,"hasUserLike":false,"slug":"","title":"Unifying real-time data processing: Kafka, Spark, and ClickHouse","authors":[],"tags":[],"locale":{"lang":"en"},"textTitle":"Unifying real-time data processing: Kafka, Spark, and ClickHouse","htmlTitle":"Unifying real-time data processing: Kafka, Spark, and ClickHouse"},{"url":"/blog/posts/2023/07/clickhouse-use-cases","id":118,"name":"clickhouse-use-cases","date":"2023-07-11T00:00:00Z","description":"","readingTime":15,"image":"/assets/blog/articles/clickhouse-usecases-small-cover.png","blogPostId":118,"likes":0,"hasUserLike":false,"slug":"","title":"ClickHouse use cases: Revolutionizing data analysis","authors":[],"tags":[],"locale":{"lang":"en"},"textTitle":"ClickHouse use cases: Revolutionizing data analysis","htmlTitle":"ClickHouse use cases: Revolutionizing data analysis"},{"url":"/blog/posts/2024/02/kafka-and-clickhouse-unlocking-the-power-duo","id":148,"name":"kafka-and-clickhouse-unlocking-the-power-duo","date":"2024-02-21T00:00:00Z","description":"Written by: Andrei Tserakhau, DoubleCloud Tech Lead","readingTime":15,"image":"/assets/blog/articles/kafka-clickhouse-schema-cover.png","blogPostId":148,"likes":0,"hasUserLike":false,"slug":"","title":"Unlocking the power duo: Kafka and ClickHouse for lightning-fast data processing","authors":[],"tags":[],"locale":{"lang":"en"},"textTitle":"Unlocking the power duo: Kafka and ClickHouse for lightning-fast data processing","htmlTitle":"Unlocking the power duo: Kafka and ClickHouse for lightning-fast data processing"}]}},"navigationData":{"newMenu":true,"header":{"leftItems":[{"text":"Why DoubleCloud","type":"dc-dropdown","data":{"view":"list","groups":[{"items":[{"text":"Performance","url":"/performance-boost/","description":"Get the best performance with the highest ROI"},{"text":"Security","url":"/security/","description":"Keep your data protected and maintain compliance"},{"text":"DoubleCloud vs. other solutions","url":"/comparison/","description":"Learn how DoubleCloud’s products compare to other solutions"},{"text":"Customer stories","url":"/resources/case-studies/","description":"See our solutions in action"}]},{"image":{"src":"/assets/doublecloud/menu-bar/menu-banner-dc-results.png.webp","style":{"width":300,"height":300}},"text":"\u003ca href='/performance-boost/' target='_self'\u003eGet more and spend less with DoubleCloud  →\u003c/a\u003e"}]}},{"text":"Products","type":"dc-dropdown","metaSchema":{"@graph":[{"@type":"SoftwareApplication","sameAs":["https://twitter.com/getdoublecloud","https://www.youtube.com/@doublecloud2499","https://www.linkedin.com/company/doublecloudplatform/","https://www.facebook.com/GetDoubleCloud/"]},{"@context":"https://schema.org","@type":"Organization","foundingDate":2022,"contactPoint":{"@type":"ContactPoint","contactType":"customer support","telephone":"+1 302-658-7581","email":"info@double.cloud"},"sameAs":["https://twitter.com/getdoublecloud","https://www.youtube.com/@doublecloud2499","https://www.linkedin.com/company/doublecloudplatform/","https://www.facebook.com/GetDoubleCloud/"]}]},"data":{"items":[{"text":"Managed Service for ClickHouse®","url":"/services/managed-clickhouse/","icon":"/assets/icons/dc-clickhouse.svg","description":"The fastest, most resource-efficient OLAP database for real-time analytics"},{"text":"Managed Service for Apache Kafka®","url":"/services/managed-kafka/","icon":"/assets/icons/dc-kafka.svg","description":"A leading data streaming technology for large-scale, data-intensive applications"},{"text":"Managed Service for Apache Airflow®","url":"/services/managed-airflow/","icon":"/assets/icons/dc-airflow.svg","description":"Open-source tool to orchestrate and monitor workflows"},{"text":"Data Transfer","url":"/services/doublecloud-transfer/","icon":"/assets/icons/dc-transfer.svg","description":"No-code ELT tool for aggregating, collecting, and migrating data"},{"text":"Data Visualization","url":"/services/doublecloud-visualization/","icon":"/assets/icons/dc-data-vis.svg","description":"Free tool to create, modify, and share dashboards and charts"}]}},{"text":"Solutions","type":"dc-dropdown","data":{"view":"list","groups":[{"title":"By use case","items":[{"text":"Customer-facing analytics","url":"/solutions/customer-facing-analytics/","description":"Provide business insights for your clients or partners"},{"text":"Real-time analytics","url":"/solutions/real-time-analytics/","description":"Build a data infrastructure to collect, process, and analyze data in real time"},{"text":"Observability and monitoring","url":"/solutions/observability-and-monitoring/","description":"Analyze terabytes of your logs, events, and traces with ease"}]},{"title":"By industry","items":[{"text":"AdTech and MarTech data analytics","url":"/solutions/adtech/","description":"Extract and analyze data from Meta ads, Google ads, LinkedIn ads, and others"},{"text":"Analytics for mobile and gaming apps","url":"/solutions/web-mobile-gaming-apps/","description":"Optimize and scale your mobile and gaming app analytics"},{"text":"EdTech data analytics","url":"/solutions/edtech/","description":"Improve online learning and identify new sales opportunities"},{"text":"FinTech data analytics","url":"/solutions/fintech-real-time-analytics/","description":"Manage and process large amounts of financial data efficiently"}]}]}},{"text":"Resources","type":"dc-dropdown","data":{"view":"list","groups":[{"title":"Using DoubleCloud","items":[{"text":"DoubleCloud API","url":"/docs/en/public-api/","description":"Read up on API tutorials and instructions","target":"_self"},{"text":"Terraform","url":"/docs/en/developer-resources/terraform/create-resources","description":"Deploy and manage cloud resources with the infrastructure-as-code approach"},{"text":"Status updates","url":"https://status.double.cloud/","description":"Check the current operational status of our services"},{"text":"Support","url":"/support/","description":"Learn more about our support tiers"}]},{"title":"Discover","items":[{"text":"Webinars","url":"/webinars/","description":"Sign up for the next webinar or watch previous ones"},{"text":"Blog","url":"/blog/","description":"Get insights from our team and the latest news"}]},{"image":{"src":"/assets/doublecloud/menu-bar/menu-banners-dc-ebook.png.webp","style":{"width":300,"height":300}},"text":"\u003ca href='/resources/clickhouse-ebook/' target='_self'\u003eGrab your ebook  →\u003c/a\u003e"}]}},{"text":"Company","type":"dc-dropdown","data":{"items":[{"text":"About DoubleCloud","url":"/company/about-us/"},{"text":"Careers","url":"/company/careers/"},{"text":"Contact us","url":"/company/contact-us/"}]}},{"text":"Pricing","url":"/pricing/"},{"text":"Documentation","url":"/docs/en/","target":"_self"}],"rightItems":[{"type":"button","text":"Slack","url":"https://join.slack.com/t/double-cloud/shared_invite/zt-1pbz9lfte-5GoIX~8CmVYqmVQfRFPNdA","img":"/assets/icons/slack.svg","theme":"flat"},{"type":"button","text":"Contact us","theme":"flat","url":"#contact-us-form"},{"type":"button","text":"Console","url":"https://app.double.cloud","theme":"accent"}]},"logo":{"icon":"/assets/logo/dc-logo-dark.svg","text":""},"footer":{"subscriptionForm":{"header":"Subscribe to our newsletter","footer":"By submitting this form, you agree to our \u003ca href=\"/legal/en/privacy/\"\u003ePrivacy policy\u003c/a\u003e","form":{"scriptSrc":"//js-eu1.hsforms.net/forms/embed/v2.js","region":"eu1","portalId":"25659674","formId":"b9015518-c7ea-4173-a96b-a251994635e3"}},"underline":{"links":[{"text":"Customer Agreement","url":"/legal/en/customer_agreement/","target":"_blank"},{"text":"Privacy Policy","url":"/legal/en/privacy/","target":"_blank"},{"text":"Pricing","url":"/pricing/"},{"text":"Security","url":"/security/","target":"_blank"}],"copyright":"© 2024 DoubleCloud"},"columns":[{"title":"Products","links":[{"text":"Managed Service for ClickHouse®","url":"/services/managed-clickhouse/"},{"text":"Managed Service for Apache Kafka®","url":"/services/managed-kafka/"},{"text":"Managed Service for Apache Airflow®","url":"/services/managed-airflow"},{"text":"Data Transfer","url":"/services/doublecloud-transfer/"},{"text":"Data Visualization","url":"/services/doublecloud-visualization"}]},{"title":"Solutions","links":[{"text":"Case studies","url":"/resources/case-studies/"},{"text":"Customer-facing analytics","url":"/solutions/customer-facing-analytics/"},{"text":"Real-time analytics","url":"/solutions/real-time-analytics/"},{"text":"Observability and monitoring","url":"/solutions/observability-and-monitoring/"},{"text":"AdTech and MarTech data analytics","url":"/solutions/adtech/"},{"text":"Analytics for mobile and gaming Apps","url":"/solutions/web-mobile-gaming-apps/"},{"text":"EdTech data analytics","url":"/solutions/edtech/"},{"text":"FinTech data analytics","url":"/solutions/fintech-real-time-analytics/"}]},{"title":"Resources","links":[{"text":"Documentation","url":"/docs/en/"},{"text":"Webinars","url":"/webinars/"},{"text":"Blog","url":"/blog/"},{"text":"Slack","url":"https://join.slack.com/t/double-cloud/shared_invite/zt-1pbz9lfte-5GoIX~8CmVYqmVQfRFPNdA"},{"text":"Support","url":"/support/"},{"text":"Status updates","url":"https://status.double.cloud/"},{"text":"Product comparisons","url":"/comparison/"},{"text":"Site map","url":"/sitemap/"}]},{"title":"Company","links":[{"text":"About DoubleCloud","url":"/company/about-us/"},{"text":"Careers","url":"/company/careers"},{"text":"AWS Partnership","url":"/aws-partnership/"},{"text":"Contact us","url":"/company/contact-us/"}]}]},"forms":{"contact":"11819433.daba96b39df83b7903708cc4842e9dbb9c944cce"},"favicon":{"folder":"/assets/favicon"},"analytics":{"id":"GTM-5M39N8J","ignore":true,"popup":{"text":"\u003cp\u003eBy\u0026nbsp;clicking \u0026ldquo;Accept\u0026rdquo;, you agree to\u0026nbsp;the storing of\u0026nbsp;cookies on\u0026nbsp;your device to\u0026nbsp;help us\u0026nbsp;analyze site usage and assist in\u0026nbsp;our marketing efforts. However, you may \u0026ldquo;Decline\u0026rdquo; that. More details here in\u0026nbsp;\u003ca href=\"/legal/en/privacy/\"\u003ePrivacy Policy\u003c/a\u003e\u003c/p\u003e","buttons":{"accept":{"size":"xl","text":"Accept"},"decline":{"size":"xl","text":"Decline"}}}}},"meta":{"title":"Analyze your {A|N}LB logs with ClickHouse | DoubleCloud","date":"2024-05-24T00:00:00Z","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png","canonicalUrl":"","organization":{"appTitle":"DoubleCloud","legalName":"DoubleCloud Inc","supportEmail":"","url":"https://double.cloud"},"description":"Learn how to efficiently analyze your ALB/NLB logs with ClickHouse. This guide covers storing logs in an S3 bucket, setting up VPC and ClickHouse at DoubleCloud, connecting ClickHouse with S3 logs via Transfer at DoubleCloud, and delving into log analysis.\"","content":"\u003cp\u003eIn\u0026nbsp;this article, we\u0026rsquo;ll talk about:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\"\u003eSetup VPC and Clickhouse at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003eConnect Clickhouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#looking-into-logs\"\u003eLooking into logs\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEnabling the power of\u0026nbsp;ClickHouse to\u0026nbsp;consolidate logs offers a\u0026nbsp;game-changing approach. It\u0026rsquo;s cost-effective, lightning-fast, and effortlessly scales to\u0026nbsp;accommodate your needs.\u003c/p\u003e\n\u003cp\u003eAWS stores Load Balancer Logs in\u0026nbsp;S3, employing a\u0026nbsp;queue system for a\u0026nbsp;seamless CDC (Change Data Capture) style delivery. This synergy between S3's queuing mechanism and ClickHouse lays a\u0026nbsp;robust foundation for efficient log analysis. And DoubleCloud makes this even easier with the power of\u0026nbsp;Transfer service.\u003c/p\u003e\n\u003cp\u003eWith Terraform at\u0026nbsp;your disposal, setting up\u0026nbsp;log aggregation becomes a\u0026nbsp;straightforward process.\u003c/p\u003e\n\u003ch2 id=\"lay-the-groundwork\"\u003e\u003ca href=\"#lay-the-groundwork\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLay the groundwork\u003c/span\u003e\u003c/a\u003eLay the groundwork\u003c/h2\u003e\n\u003cp\u003eSo, how do\u0026nbsp;you build the essential components for a\u0026nbsp;scalable and fast observability stack, dedicated to\u0026nbsp;dissecting and understanding AWS NLB or\u0026nbsp;ALB access logs?\u003c/p\u003e\n\u003cp\u003eTo\u0026nbsp;set the stage, envision a\u0026nbsp;baseline scenario\u0026nbsp;\u0026mdash; a\u0026nbsp;typical application setup incorporating an\u0026nbsp;AWS Load Balancer. As\u0026nbsp;a\u0026nbsp;fundamental part of\u0026nbsp;AWS services, Load Balancers funnel logs into an\u0026nbsp;S3 bucket. Now, let\u0026rsquo;s take a\u0026nbsp;guided tour through the step-by-step process, unveiling how these essential load-balancer logs seamlessly become accessible for real-time analysis in\u0026nbsp;ClickHouse, all orchestrated through Terraform.\u003c/p\u003e\n\u003cp\u003eBut before we\u0026nbsp;venture into the Terraform magic, it\u0026rsquo;s essential to\u0026nbsp;picture the existing infrastructure and the pivotal Terraform code that configures the seamless interplay between S3 and SQS for the ALB.\u003c/p\u003e\n\n\u003ch2 id=\"s3-bucket-where-the-logs-are-stored-by-aws\"\u003e\u003ca href=\"#s3-bucket-where-the-logs-are-stored-by-aws\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/span\u003e\u003c/a\u003eS3 bucket where the logs are stored by\u0026nbsp;AWS\u003c/h2\u003e\n\u003cp\u003eAt\u0026nbsp;the outset, our priority is\u0026nbsp;setting up\u0026nbsp;log storage for your ALB, a\u0026nbsp;crucial step that involves binding an\u0026nbsp;S3 bucket to\u0026nbsp;your existing ALB.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s kick off with the foundational element: the creation of\u0026nbsp;an\u0026nbsp;S3 Bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L1-L3\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket\" \"nlb_logs\" {\n  bucket = var.bucket_name\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis snippet lays the groundwork by\u0026nbsp;creating an\u0026nbsp;S3 bucket dedicated to\u0026nbsp;storing ALB logs, thereby serving as\u0026nbsp;a\u0026nbsp;repository for AWS ALB logs.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_lb\" \"alb\" {\n  /* your config\n  */\n\n  dynamic \"access_logs\" {\n    for_each = var.access_logs_bucket != null ? { enabled = true } : {}\n\n    content {\n      enabled = true\n      bucket  = var.bucket_name\n      prefix  = var.access_logs_bucket_prefix\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s move forward with setting up\u0026nbsp;the necessary configuration for an\u0026nbsp;SQS queue to\u0026nbsp;complement this S3 bucket.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/sqs.tf#L1-L20\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_sqs_queue\" \"nlb_logs_queue\" {\n  name   = var.sqs_name\n  policy = \u0026lt;\u0026lt;POLICY\n{\n  \"Version\": \"2012-10-17\",\n  \"Id\": \"sqspolicy\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"sqs:SendMessage\",\n      \"Resource\": \"arn:aws:sqs:*:*:${var.sqs_name}\",\n      \"Condition\": {\n        \"ArnEquals\": { \"aws:SourceArn\": \"${aws_s3_bucket.nlb_logs.arn}\" }\n      }\n    }\n  ]\n}\nPOLICY\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"23\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-23\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-23\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-23.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis code initiates the creation of\u0026nbsp;an\u0026nbsp;SQS queue, facilitating the seamless delivery of\u0026nbsp;ALB logs to\u0026nbsp;the designated S3 bucket.\u003c/p\u003e\n\u003cp\u003eAs\u0026nbsp;logs are delivered, they are automatically organized within a\u0026nbsp;dedicated folder:\u003c/p\u003e\n\n\u003cp\u003eRegularly generated new log files demand a\u0026nbsp;streamlined approach for notification and processing. To\u0026nbsp;establish a\u0026nbsp;seamless notification channel, we\u0026rsquo;ll configure an\u0026nbsp;optimal push notification system via\u0026nbsp;SQS. Referencing the guidelines outlined in\u0026nbsp;\u003ca href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html\"\u003eAmazon S3's notification configuration documentation\u003c/a\u003e, our next step involves the creation of\u0026nbsp;an\u0026nbsp;SQS queue. This queue will serve as\u0026nbsp;the conduit for receiving timely notifications, ensuring prompt handling and processing of\u0026nbsp;newly generated log files within our S3 bucket.\u003c/p\u003e\n\u003cp\u003eThis linkage is\u0026nbsp;solidified through the creation of\u0026nbsp;the SQS queue:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/s3.tf#L54-L61\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"aws_s3_bucket_notification\" \"nlb_logs_bucket_notification\" {\n  bucket = aws_s3_bucket.nlb_logs.id\n\n  queue {\n    queue_arn = aws_sqs_queue.nlb_logs_queue.arn\n    events    = [\"s3:ObjectCreated:*\"]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eAll the configurations implemented so\u0026nbsp;far serve as\u0026nbsp;the foundational infrastructure for streamlined log storage. From setting up\u0026nbsp;the S3 bucket to\u0026nbsp;configuring the SQS queue and establishing the intricate linkage between them, this orchestrated setup forms the backbone for efficient log management and processing:\u003c/p\u003e\n\n\u003cp\u003eThe illustration above showcases the composed architecture, where the S3 bucket, SQS queue, and their interconnection stand as\u0026nbsp;pivotal components for storing and managing logs effectively within the AWS environment.\u003c/p\u003e\n\u003cp\u003eLogs are now in\u0026nbsp;your S3 bucket, but reading them may be\u0026nbsp;challenging. Lets take a\u0026nbsp;look at\u0026nbsp;a\u0026nbsp;data sample:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003etls 2.0 2024-01-02T23:58:58 net/preprod-public-api-dt-tls/9f8794be28ab2534 4d9af2ddde90eb82 84.247.112.144:33342 10.0.223.207:443 244 121 0 15 - arn:aws:acm:eu-central-1:840525340941:certificate/5240a1e4-c7fe-44c1-9d89-c256213c5d23 - ECDHE-RSA-AES128-GCM-SHA256 tlsv12 - 18.193.17.109 - - \"%ef%b5%bd%8\" 2024-01-02T23:58:58\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"6\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-6\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-6\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-6.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThe snippet above represents a\u0026nbsp;sample of\u0026nbsp;the log data residing within the S3 bucket. Understanding data\u0026rsquo;s format and content will help us\u0026nbsp;to\u0026nbsp;build an\u0026nbsp;efficient strategy to\u0026nbsp;parse and store it.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s move this data to\u0026nbsp;DoubleCloud\u0026rsquo;s Managed ClickHouse.\u003c/p\u003e\n\u003ch2 id=\"setup-vpc-and-clickhouse-at-doublecloud\"\u003e\u003ca href=\"#setup-vpc-and-clickhouse-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eSetup VPC and ClickHouse at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eNext, DoubleCloud comes to\u0026nbsp;our rescue. We\u0026nbsp;will add VPC (Virtual Private Cloud) and managed ClickHouse to\u0026nbsp;serve as\u0026nbsp;the dedicated storages for our logs.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/network.tf#L1-L7\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_network\" \"nlb-network\" {\n  project_id      = var.project_id\n  name            = var.network_name\n  region_id       = var.region\n  cloud_type      = var.cloud_type\n  ipv4_cidr_block = var.ipv4_cidr\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s proceed by\u0026nbsp;illustrating the integration of\u0026nbsp;VPC and ClickHouse within this setup for our log storage. Let\u0026rsquo;s create an\u0026nbsp;instance of\u0026nbsp;ClickHouse within the VPC:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/ch.tf#L1-L35\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_clickhouse_cluster\" \"nlb-logs-clickhouse-cluster\" {\n  project_id = var.project_id\n  name       = var.clickhouse_cluster_name\n  region_id  = var.region\n  cloud_type = var.cloud_type\n  network_id = resource.doublecloud_network.nlb-network.id\n\n  resources {\n    clickhouse {\n      resource_preset_id = var.clickhouse_cluster_resource_preset\n      disk_size          = 34359738368\n      replica_count      = 1\n    }\n  }\n\n  config {\n    log_level       = \"LOG_LEVEL_INFORMATION\"\n    max_connections = 120\n  }\n\n  access {\n    data_services = [\"transfer\"]\n    ipv4_cidr_blocks = [\n      {\n        value       = var.ipv4_cidr\n        description = \"VPC CIDR\"\n      }\n    ]\n  }\n}\n\ndata \"doublecloud_clickhouse\" \"nlb-logs-clickhouse\" {\n  project_id = var.project_id\n  id         = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"16\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-16\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-16\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-16.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\"\u003e\u003ca href=\"#connect-clickhouse-with-s3-logs-via-transfer-at-doublecloud\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/span\u003e\u003c/a\u003eConnect ClickHouse with S3 Logs via Transfer at\u0026nbsp;DoubleCloud\u003c/h2\u003e\n\u003cp\u003eTo\u0026nbsp;connect S3 with ClickHouse, we\u0026rsquo;ll use DoubleCloud\u0026rsquo;s Transfer service, which is\u0026nbsp;a\u0026nbsp;powerful ELT tool.\u003c/p\u003e\n\u003cp\u003eEstablishing a\u0026nbsp;DoubleCloud Transfer (ELT pipeline) involves setting up\u0026nbsp;a\u0026nbsp;source and target endpoint. The Terraform code snippet below outlines the source endpoint:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L1-L197\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-s3-s32ch-source\" {\n  name       = var.transfer_source_name\n  project_id = var.project_id\n  settings {\n    object_storage_source {\n      provider {\n        bucket                = var.bucket_name\n        path_prefix           = var.bucket_prefix\n        aws_access_key_id     = var.aws_access_key_id\n        aws_secret_access_key = var.aws_access_key_secret\n        region                = var.region\n        endpoint              = var.endpoint\n        use_ssl               = true\n        verify_ssl_cert       = true\n      }\n      format {\n        csv {\n          delimiter = \" \" // space as delimiter\n          advanced_options {\n          }\n          additional_options {\n          }\n        }\n      }\n      event_source {\n        sqs {\n          queue_name = var.sqs_name\n        }\n      }\n      result_table {\n        add_system_cols = true\n        table_name      = var.transfer_source_table_name\n        table_namespace = var.transfer_source_table_namespace\n      }\n      result_schema {\n        data_schema {\n          fields {\n            field {\n              name     = \"type\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"0\"\n            }\n            field {\n              name     = \"version\"\n              type     = \"string\"\n              required = false\n              key      = false\n              path     = \"1\"\n            }\n            /*\n              Rest of Fields\n            */\n            field {\n              name     = \"tls_connection_creation_time\"\n              type     = \"datetime\"\n              required = false\n              key      = false\n              path     = \"21\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"12\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-12\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-12\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-12.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThis Terraform code snippet delineates the source endpoint configuration, encompassing S3 connection details, data format, event notifications using an\u0026nbsp;SQS queue, and the schema definition for data stored within the S3 bucket.\u003c/p\u003e\n\u003cp\u003eOnce we\u0026nbsp;have a\u0026nbsp;source, let\u0026rsquo;s make a\u0026nbsp;target. It\u0026nbsp;easier, since it\u0026rsquo;s just a\u0026nbsp;ClickHouse:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L199-L215\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer_endpoint\" \"nlb-ch-s32ch-target\" {\n  name       = var.transfer_target_name\n  project_id = var.project_id\n  settings {\n    clickhouse_target {\n      clickhouse_cleanup_policy = \"DROP\"\n      connection {\n        address {\n          cluster_id = doublecloud_clickhouse_cluster.nlb-logs-clickhouse-cluster.id\n        }\n        database = \"default\"\n        password = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.password\n        user     = data.doublecloud_clickhouse.nlb-logs-clickhouse.connection_info.user\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"22\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-22\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-22\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-22.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eThese two pieces can then be\u0026nbsp;composed into a\u0026nbsp;transfer:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/blob/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack/transfer.tf#L217-L224\"\u003eClick to\u0026nbsp;view an\u0026nbsp;example on\u0026nbsp;Github\u003c/a\u003e\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eresource \"doublecloud_transfer\" \"nlb-logs-s32ch\" {\n  name       = var.transfer_name\n  project_id = var.project_id\n  source     = doublecloud_transfer_endpoint.nlb-s3-s32ch-source.id\n  target     = doublecloud_transfer_endpoint.nlb-ch-s32ch-target.id\n  type       = \"INCREMENT_ONLY\"\n  activated  = false\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"29\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-29\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-29\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-29.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eOnce the transfer has been established, a\u0026nbsp;comprehensive delivery pipeline takes shape:\u003c/p\u003e\n\n\n\n\u003cp\u003eThe illustration above represents the culmination of\u0026nbsp;our efforts\u0026nbsp;\u0026mdash; a\u0026nbsp;complete delivery pipeline primed for seamless data flow. This integrated system, incorporating S3, SQS, VPC, ClickHouse, and the orchestrated configurations, stands ready to\u0026nbsp;handle, process, and analyze log data efficiently and effectively at\u0026nbsp;any scale.\u003c/p\u003e\n\u003ch2 id=\"looking-into-logs\"\u003e\u003ca href=\"#looking-into-logs\" class=\"yfm-anchor\" aria-hidden=\"true\"\u003e\u003cspan class=\"visually-hidden\"\u003eLooking into logs\u003c/span\u003e\u003c/a\u003eLooking into logs\u003c/h2\u003e\n\u003cp\u003eNow, it\u0026rsquo;s time to\u0026nbsp;explore your data in\u0026nbsp;ClickHouse. Let\u0026rsquo;s dive into querying your structured logs and uncover insights within this robustly organized dataset. To\u0026nbsp;connect to\u0026nbsp;your newly create DB\u0026nbsp;you can use clickhouse-client:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eclickhouse-client \\\\\n  --host $CH_HOST \\\\\n  --port 9440 \\\\\n  --secure \\\\\n  --user admin \\\\\n  --password $CH_PASSWORD\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"9\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-9\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-9\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-9.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eLet\u0026rsquo;s start by\u0026nbsp;getting an\u0026nbsp;overview of\u0026nbsp;the total count of\u0026nbsp;logs. This simple query will provide us\u0026nbsp;with an\u0026nbsp;initial grasp of\u0026nbsp;the volume of\u0026nbsp;data we\u0026rsquo;re working on\u0026nbsp;within our ClickHouse dataset:\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT count(*)\nFROM logs_alb\n\nQuery id: 6cf59405-2a61-451b-9579-a7d340c8fd5c\n\n┌──count()─┐\n│ 15935887 │\n└──────────┘\n\n1 row in set. Elapsed: 0.457 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"13\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-13\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-13\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-13.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eNow, let\u0026rsquo;s zoom in\u0026nbsp;and retrieve a\u0026nbsp;specific row from our dataset. This targeted query will fetch a\u0026nbsp;single record, allowing us\u0026nbsp;to\u0026nbsp;closely examine the details encapsulated within this individual log entry.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT *\nFROM logs_alb\nLIMIT 1\nFORMAT Vertical\n\nQuery id: 44fc6045-a5be-47e2-8482-3033efb58206\n\nRow 1:\n──────\ntype:                         tls\nversion:                      2.0\ntime:                         2023-11-20 21:05:01\nelb:                          net/*****/*****\nlistener:                     92143215dc51bb35\nclient_port:                  10.0.246.57:55534\ndestination_port:             10.0.39.32:443\nconnection_time:              1\ntls_handshake_time:           -\nreceived_bytes:               0\nsent_bytes:                   0\nincoming_tls_alert:           -\nchosen_cert_arn:              -\nchosen_cert_serial:           -\ntls_cipher:                   -\ntls_protocol_version:         -\ntls_named_group:              -\ndomain_name:                  -\nalpn_fe_protocol:             -\nalpn_be_protocol:             -\nalpn_client_preference_list:  -\ntls_connection_creation_time: 2023-11-20 21:05:01\n__file_name:                  api/AWSLogs/******/elasticloadbalancing/eu-central-1/2023/11/20/****-central-1_net.****.log.gz\n__row_index:                  1\n__data_transfer_commit_time:  1700514476000000000\n__data_transfer_delete_time:  0\n\n1 row in set. Elapsed: 0.598 sec.\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"17\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-17\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-17\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-17.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eTime for a\u0026nbsp;quick analysis: let\u0026rsquo;s execute a\u0026nbsp;straightforward group by\u0026nbsp;query to\u0026nbsp;determine the most frequently used destination ports.\u003c/p\u003e\n\n    \u003cdiv class=\"yfm-clipboard\"\u003e\n    \u003cpre\u003e\u003ccode class=\"hljs\"\u003eSELECT\n    destination_port,\n    count(*)\nFROM logs_alb\nGROUP BY destination_port\n\nQuery id: a4ab55db-9208-484f-b019-a5c13d779063\n\n┌─destination_port──┬─count()─┐\n│ 10.0.234.156:443  │   10148 │\n│ 10.0.205.254:443  │   12639 │\n│ 10.0.209.51:443   │   13586 │\n│ 10.0.223.207:443  │   10125 │\n│ 10.0.39.32:443    │ 4860701 │\n│ 10.0.198.39:443   │   13837 │\n│ 10.0.224.240:443  │    9546 │\n│ 10.10.162.244:443 │  416893 │\n│ 10.0.212.130:443  │    9955 │\n│ 10.0.106.172:443  │ 4860359 │\n│ 10.10.111.92:443  │  416908 │\n│ 10.0.204.18:443   │    9789 │\n│ 10.10.24.126:443  │  416881 │\n│ 10.0.232.19:443   │   13603 │\n│ 10.0.146.100:443  │ 4862200 │\n└───────────────────┴─────────┘\n\n15 rows in set. Elapsed: 1.101 sec. Processed 15.94 million rows, 405.01 MB (14.48 million rows/s., 368.01 MB/s.)\n\u003c/code\u003e\u003c/pre\u003e\n\n    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"21\"\u003e\n        \u003cpath fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"\u003e\u003c/path\u003e\n        \u003cpath stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\"\u003e\n            \u003canimate id=\"visibileAnimation-21\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin\u003e\u003c/animate\u003e\n            \u003canimate id=\"hideAnimation-21\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-21.end+1\" fill=\"freeze\"\u003e\u003c/animate\u003e\n        \u003c/path\u003e\n    \u003c/svg\u003e\n    \u003c/div\u003e\n\u003cp\u003eExplore the complete example in\u0026nbsp;our \u003ca href=\"https://github.com/doublecloud/terraform-provider-doublecloud/tree/96644e7a4e3fa14720dcbb284fbbeccd2ec086bb/example_projects/transfer/nlb_observability_stack\"\u003eTerraform project\u003c/a\u003e for a\u0026nbsp;hands-on experience with log querying in\u0026nbsp;ClickHouse.\u003c/p\u003e\n","sharing":{"title":"Analyze your {A|N}LB logs with ClickHouse","description":"\u003cp\u003eWritten by: Andrei Tserakhau, DoubleCloud Tech Lead\u003c/p\u003e","image":"/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-sharing.png","shareGenImage":"","shareGenTitle":"Analyze your {A|N}LB logs with ClickHouse"},"keywords":[],"noIndex":false,"authors":[],"tags":[{"icon":null,"slug":"insights","name":"Insights","createdAt":"","updatedAt":"","count":0},{"icon":null,"slug":"ClickHouse","name":"ClickHouse","createdAt":"","updatedAt":"","count":0}],"metaSchema":{"@context":"https://schema.org","@graph":[{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"insights","name":"Insights"}},{"@type":"ListItem","position":2,"item":{"@id":"ClickHouse","name":"ClickHouse"}}]},{"@type":"BlogPosting","@id":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","url":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","name":"Analyze your {A|N}LB logs with ClickHouse","headline":"Analyze your {A|N}LB logs with ClickHouse","abstract":"\u003cp\u003eWritten by: Andrei Tserakhau, DoubleCloud Tech Lead\u003c/p\u003e","description":"\u003cp\u003eWritten by: Andrei Tserakhau, DoubleCloud Tech Lead\u003c/p\u003e","dateCreated":"2024-05-24T00:00:00Z","datePublished":"2024-05-24T00:00:00Z","dateModified":"2024-05-24T00:00:00Z","author":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"creator":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"publisher":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"copyrightHolder":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}},"copyrightYear":2025,"mainEntityOfPage":{"@type":"WebPage","@id":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/"},"inLanguage":{"@type":"Language","name":"English","alternateName":"en"},"keywords":["Insights","ClickHouse"],"image":"https://double.cloud/assets/blog/articles/2024/analyze-your-anlb-logs-with-clickhouse-small-cover.png","sharedContent":{"@type":"WebPage","headline":"Analyze your {A|N}LB logs with ClickHouse","url":"https://double.cloud/blog/posts/2024/05/analyze-your-anlb-logs-with-clickhouse/","author":{"@type":"Organization","name":"DoubleCloud","legalName":"DoubleCloud Inc","url":"https://double.cloud/","logo":{"@type":"ImageObject","url":"","width":32,"height":32}}},"wordCount":"","articleBody":""}]}},"routingData":{"hostname":"double.cloud"},"deviceData":{"isRobot":true,"isMobile":false,"isTablet":false},"csrfToken":"dNLlhKiC-ZR86paHGCahSNc8YC8nvgtt2qKI","clientConfig":{"appTitle":"DoubleCloud","legalName":"DoubleCloud Inc","supportEmail":"","hosts":{"site":"https://double.cloud","console":"https://app.double.cloud"}},"ignoreConsent":false,"noNextImg":false,"noSnippet":null},"__N_SSP":true},"page":"/blog/posts/[...slug]","query":{"slug":["2024","05","analyze-your-anlb-logs-with-clickhouse"]},"buildId":"HkxA3M0ES7gp3V0n_0ecw","isFallback":false,"gssp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>